<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Portal Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore-compat.js"></script>
    <style>
        :root {
            --primary: #4361ee;
            --primary-dark: #3a56d4;
            --secondary: #7209b7;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #0ea5e9;
            --light: #f8f9fa;
            --dark: #1f2937;
            --gray: #6b7280;
            --gray-light: #e5e7eb;
            --border-radius: 8px;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--dark);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: var(--border-radius);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .logo-area {
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
            cursor: pointer;
            transition: opacity 0.3s ease;
        }

        .logo:hover {
            opacity: 0.8;
        }

        .logo-icon {
            font-size: 2rem;
        }

        .course-info {
            display: flex;
            gap: 15px;
            color: var(--gray);
            font-size: 0.9rem;
        }

        .course-name, .course-code {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 5px 10px;
            background: var(--light);
            border-radius: 20px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-details h4 {
            margin: 0;
            color: var(--dark);
        }

        .user-details p {
            margin: 0;
            font-size: 0.85rem;
            color: var(--gray);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .logout-btn {
            background: var(--light);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            color: var(--danger);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: var(--danger);
            color: white;
            transform: scale(1.05);
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 20px;
            margin-bottom: 20px;
        }

        .welcome-banner {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 30px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            box-shadow: var(--shadow-lg);
        }

        .welcome-text h2 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .card {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .section-title {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--light);
            color: var(--primary);
            font-weight: 600;
            cursor: pointer;
            user-select: none;
        }

        .section-title i {
            font-size: 1.2rem;
            transition: transform 0.3s ease;
        }

        .section-title.collapsed i.fa-chevron-down {
            transform: rotate(-90deg);
        }

        .collapsible-content {
            max-height: 500px;
            overflow: hidden;
            transition: max-height 0.3s ease, opacity 0.3s ease;
            opacity: 1;
        }

        .collapsible-content.collapsed {
            max-height: 0;
            opacity: 0;
            overflow: hidden;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-outline {
            background: white;
            color: var(--primary);
            border: 2px solid var(--primary);
        }

        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }

        .btn-secondary {
            background: var(--secondary);
            color: white;
        }

        .btn-secondary:hover {
            background: #5e08a0;
        }

        .btn-gray {
            background: #f3f4f6;
            color: var(--dark);
            border: 1px solid #d1d5db;
        }

        .btn-gray:hover {
            background: #e5e7eb;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 0.8rem;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .status-connected { background: #d1fae5; color: #065f46; }
        .status-offline { background: #fee2e2; color: #991b1b; }
        .status-active { background: #d1fae5; color: #065f46; }
        .status-pending { background: #fef3c7; color: #92400e; }
        .status-completed { background: #dbeafe; color: #1e40af; }
        .status-absent { background: #fee2e2; color: #991b1b; }
        .status-present { background: #d1fae5; color: #065f46; }
        .status-late { background: #fef3c7; color: #92400e; }
        .status-bsit { background: #e0f2fe; color: #0369a1; }
        .status-bscs { background: #fce7f3; color: #be185d; }
        .status-inc { background: #fee2e2; color: #991b1b; }
        .status-completion { background: #d1fae5; color: #065f46; }
        .status-overdue { background: #fef3c7; color: #92400e; }

        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message, .success-message {
            padding: 15px 20px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            display: none;
        }

        .error-message {
            background: var(--danger);
            color: white;
            border-left: 4px solid #dc2626;
        }

        .success-message {
            background: var(--success);
            color: white;
            border-left: 4px solid #059669;
        }

        .connection-banner {
            padding: 10px 20px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            display: none;
            text-align: center;
        }

        .connection-banner.warning {
            background: #fef3c7;
            color: #92400e;
            border-left: 4px solid #f59e0b;
        }

        .connection-banner.info {
            background: #dbeafe;
            color: #1e40af;
            border-left: 4px solid #3b82f6;
        }

        .connection-banner.success {
            background: #d1fae5;
            color: #065f46;
            border-left: 4px solid #10b981;
        }

        .service-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .academic-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .info-card {
            background: #f8fafc;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid var(--primary);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .info-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .info-card .label {
            font-size: 0.9rem;
            color: #64748b;
            margin-bottom: 5px;
        }

        .info-card .value {
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--dark);
        }

        .subject-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .subject-card:hover {
            border-color: var(--primary);
        }

        .notification-item {
            padding: 10px 0;
            border-bottom: 1px solid #e5e7eb;
        }

        .notification-item:last-child {
            border-bottom: none;
        }

        .notification-time {
            font-size: 0.85rem;
            color: var(--gray);
        }

        .notification-title {
            font-weight: 500;
            margin-top: 2px;
        }

        .notification-message {
            font-size: 0.9rem;
            color: var(--dark);
            margin-top: 3px;
        }

        /* ==================== MODAL STYLES ==================== */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            overflow-y: auto;
        }

        .modal-content {
            background-color: white;
            margin: 30px auto;
            width: 95%;
            max-width: 1200px;
            border-radius: var(--border-radius);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            animation: modalFadeIn 0.3s ease-out;
        }

        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 1.5rem;
        }

        .modal-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }

        .modal-body {
            padding: 0;
            max-height: calc(100vh - 200px);
            overflow-y: auto;
        }

        /* ==================== SUBJECT COMPLETION MODAL STYLES ==================== */
        .subject-completion-section {
            padding: 30px;
        }

        .student-info-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: var(--border-radius);
            margin-bottom: 25px;
        }

        .student-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .student-info-item {
            display: flex;
            flex-direction: column;
        }

        .student-info-label {
            font-size: 0.85rem;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .student-info-value {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .inc-subjects-table-container {
            margin: 25px 0;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            overflow-x: auto;
        }

        .inc-subjects-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1000px;
        }

        .inc-subjects-table th {
            background: #f3f4f6;
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
            color: var(--dark);
            border-bottom: 2px solid #e5e7eb;
            font-size: 0.9rem;
        }

        .inc-subjects-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e5e7eb;
            font-size: 0.9rem;
        }

        .inc-subjects-table tr:hover {
            background: #f9fafb;
        }

        .inc-subjects-table tr.inc-row {
            background: #fef2f2;
        }

        .inc-subjects-table tr.completed-row {
            background: #f0f9ff;
        }

        .inc-subjects-table tr.overdue-row {
            background: #fef3c7;
        }

        .time-remaining {
            font-weight: 600;
            font-size: 0.85rem;
        }

        .time-remaining.danger {
            color: #ef4444;
        }

        .time-remaining.warning {
            color: #f59e0b;
        }

        .time-remaining.success {
            color: #10b981;
        }

        .completion-form {
            background: #f8fafc;
            border-radius: 8px;
            padding: 25px;
            margin: 25px 0;
        }

        .completion-instructions {
            background: #dbeafe;
            border: 1px solid #93c5fd;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .completion-instructions h4 {
            color: #1e40af;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .completion-instructions ul {
            margin: 10px 0 0 20px;
            font-size: 0.9rem;
            color: #374151;
        }

        .completion-instructions li {
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .requirements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .requirement-item {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
        }

        .requirement-title {
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .requirement-list {
            list-style: none;
        }

        .requirement-list li {
            padding: 8px 0;
            border-bottom: 1px solid #f3f4f6;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .requirement-list li:last-child {
            border-bottom: none;
        }

        .requirement-checkbox {
            width: 18px;
            height: 18px;
        }

        /* ==================== ATTENDANCE MODAL STYLES ==================== */
        .attendance-section {
            padding: 30px;
        }

        .attendance-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            box-shadow: var(--shadow);
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            margin: 5px 0;
        }

        .stat-present { color: var(--success); }
        .stat-absent { color: var(--danger); }
        .stat-late { color: var(--warning); }

        .attendance-table-container {
            margin: 20px 0;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            overflow-x: auto;
        }

        .attendance-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }

        .attendance-table th {
            background: #f3f4f6;
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
            color: var(--dark);
            border-bottom: 2px solid #e5e7eb;
            font-size: 0.9rem;
        }

        .attendance-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e5e7eb;
            font-size: 0.9rem;
        }

        .date-badge {
            background: #f3f4f6;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .month-header {
            background: var(--primary);
            color: white;
            padding: 10px 15px;
            font-weight: 600;
        }

        /* ==================== DOCUMENTS MODAL STYLES ==================== */
        .documents-section {
            padding: 30px;
        }

        .documents-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .document-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .document-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary);
        }

        .document-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            margin-bottom: 15px;
        }

        .document-name {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--dark);
        }

        .document-size {
            font-size: 0.85rem;
            color: var(--gray);
            margin-bottom: 10px;
        }

        .document-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        /* ==================== CAMPUS RESOURCES MODAL STYLES ==================== */
        .resources-section {
            padding: 30px;
        }

        .resource-category {
            margin-bottom: 30px;
        }

        .category-title {
            font-size: 1.2rem;
            color: var(--primary);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e5e7eb;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .resources-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .resource-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .resource-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .resource-icon {
            color: var(--primary);
            font-size: 1.5rem;
            margin-bottom: 15px;
        }

        .resource-name {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--dark);
        }

        .resource-desc {
            font-size: 0.9rem;
            color: var(--gray);
            margin-bottom: 10px;
            line-height: 1.4;
        }

        .resource-status {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .status-open { background: #d1fae5; color: #065f46; }
        .status-closed { background: #fee2e2; color: #991b1b; }
        .status-limited { background: #fef3c7; color: #92400e; }

        /* ==================== STUDENT CLUBS MODAL STYLES ==================== */
        .clubs-section {
            padding: 30px;
        }

        .clubs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .club-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .club-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .club-header {
            padding: 20px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .club-name {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .club-category {
            font-size: 0.85rem;
            opacity: 0.9;
        }

        .club-body {
            padding: 20px;
        }

        .club-description {
            color: var(--gray);
            font-size: 0.9rem;
            margin-bottom: 15px;
            line-height: 1.4;
        }

        .club-meta {
            display: flex;
            justify-content: space-between;
            color: var(--gray);
            font-size: 0.85rem;
            margin-bottom: 15px;
        }

        .club-members {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .club-actions {
            display: flex;
            gap: 10px;
        }

        /* ==================== HEALTH SERVICES MODAL STYLES ==================== */
        .health-section {
            padding: 30px;
        }

        .health-services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .service-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .service-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            border-color: #10b981;
        }

        .service-icon {
            color: #10b981;
            font-size: 1.5rem;
            margin-bottom: 15px;
        }

        .service-name {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--dark);
        }

        .service-desc {
            font-size: 0.9rem;
            color: var(--gray);
            margin-bottom: 10px;
            line-height: 1.4;
        }

        .service-hours {
            font-size: 0.85rem;
            color: var(--gray);
            margin-bottom: 15px;
        }

        .emergency-contacts {
            background: #fef2f2;
            border: 1px solid #fee2e2;
            border-radius: 8px;
            padding: 20px;
            margin-top: 30px;
        }

        .emergency-title {
            color: #ef4444;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .contact-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
        }

        .contact-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .contact-icon {
            color: #ef4444;
        }

        /* ==================== CALENDAR STYLES ==================== */
        .calendar-container {
            padding: 10px 0;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .calendar-nav-btn {
            background: var(--light);
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .calendar-nav-btn:hover {
            background: var(--primary);
            color: white;
        }

        .calendar-month-year {
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--dark);
        }

        .calendar-weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-bottom: 10px;
        }

        .weekday {
            text-align: center;
            font-size: 0.85rem;
            color: var(--gray);
            padding: 8px;
            font-weight: 500;
        }

        .calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #e5e7eb;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .calendar-day:hover {
            background: var(--primary);
            color: white;
            transform: scale(1.05);
        }

        .calendar-day.current-month {
            color: var(--dark);
        }

        .calendar-day.other-month {
            color: #9ca3af;
            background: #f9fafb;
        }

        .calendar-day.today {
            background: var(--primary);
            color: white;
            font-weight: bold;
        }

        .calendar-day.selected {
            background: var(--secondary);
            color: white;
            font-weight: bold;
        }

        .calendar-day.has-event {
            position: relative;
        }

        .calendar-day.has-event::after {
            content: '';
            position: absolute;
            bottom: 4px;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 4px;
            background: var(--primary);
            border-radius: 50%;
        }

        .calendar-events {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid #e5e7eb;
        }

        .calendar-events-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--dark);
        }

        .calendar-event-item {
            padding: 10px;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            margin-bottom: 8px;
        }

        .calendar-event-time {
            font-size: 0.85rem;
            color: var(--primary);
            font-weight: 500;
        }

        .calendar-event-title {
            font-weight: 500;
            margin-top: 2px;
        }

        .calendar-event-class {
            font-size: 0.85rem;
            color: var(--gray);
            margin-top: 2px;
        }

        .calendar-empty {
            text-align: center;
            padding: 20px;
            color: var(--gray);
            font-style: italic;
        }

        /* ==================== PROFILE NAVIGATION ==================== */
        .profile-nav {
            display: flex;
            background: #f8fafc;
            border-bottom: 1px solid #e5e7eb;
            overflow-x: auto;
            padding: 0 20px;
        }

        .profile-nav-item {
            padding: 15px 20px;
            border: none;
            background: none;
            color: var(--gray);
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            border-bottom: 3px solid transparent;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .profile-nav-item:hover {
            color: var(--primary);
            background: rgba(67, 97, 238, 0.05);
        }

        .profile-nav-item.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
            background: rgba(67, 97, 238, 0.1);
        }

        .profile-content {
            padding: 30px;
        }

        .profile-section {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .profile-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-title-modal {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 25px;
            color: var(--primary);
            font-size: 1.2rem;
            font-weight: 600;
        }

        .section-title-modal i {
            font-size: 1.2rem;
        }

        /* ==================== STEPPER STYLES (FOR PAYMENT) ==================== */
        .stepper {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 30px;
            background: #f8fafc;
            border-bottom: 1px solid #e5e7eb;
        }

        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            flex: 1;
        }

        .step:not(:last-child)::after {
            content: '';
            position: absolute;
            top: 20px;
            left: 60%;
            width: 80%;
            height: 2px;
            background: #d1d5db;
            z-index: 1;
        }

        .step.active:not(:last-child)::after {
            background: var(--primary);
        }

        .step.completed:not(:last-child)::after {
            background: var(--success);
        }

        .step-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: white;
            border: 2px solid #d1d5db;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #9ca3af;
            z-index: 2;
            transition: all 0.3s ease;
        }

        .step.active .step-icon {
            border-color: var(--primary);
            background: var(--primary);
            color: white;
        }

        .step.completed .step-icon {
            border-color: var(--success);
            background: var(--success);
            color: white;
        }

        .step-label {
            margin-top: 8px;
            font-size: 0.85rem;
            font-weight: 500;
            color: #9ca3af;
        }

        .step.active .step-label {
            color: var(--primary);
        }

        .step.completed .step-label {
            color: var(--success);
        }

        /* ==================== FORM STYLES ==================== */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            margin-bottom: 6px;
            color: var(--dark);
            font-weight: 500;
            font-size: 0.9rem;
        }

        .form-control {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }

        .form-select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 0.95rem;
            background-color: white;
            cursor: pointer;
        }

        .form-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }

        .form-check {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
        }

        .form-check-input {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .form-check-label {
            font-size: 0.9rem;
            color: var(--dark);
            cursor: pointer;
        }

        .form-row {
            display: flex;
            gap: 15px;
        }

        .form-row .form-group {
            flex: 1;
        }

        .form-hint {
            font-size: 0.8rem;
            color: var(--gray);
            margin-top: 4px;
        }

        .form-actions {
            display: flex;
            justify-content: space-between;
            gap: 15px;
            padding-top: 20px;
            border-top: 1px solid #e5e7eb;
            margin-top: 30px;
        }

        .form-actions.profile {
            justify-content: flex-end;
        }

        /* ==================== TABLE STYLES ==================== */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        .data-table th {
            background: #f3f4f6;
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
            color: var(--dark);
            border-bottom: 2px solid #e5e7eb;
            font-size: 0.9rem;
        }

        .data-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e5e7eb;
            font-size: 0.9rem;
        }

        .data-table tr:hover {
            background: #f9fafb;
        }

        /* ==================== SUBJECT TABLE STYLES ==================== */
        .subject-table-container {
            margin: 20px 0;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
        }

        .subject-table {
            width: 100%;
            border-collapse: collapse;
        }

        .subject-table th {
            background: #f3f4f6;
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
            color: var(--dark);
            border-bottom: 2px solid #e5e7eb;
            font-size: 0.9rem;
        }

        .subject-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e5e7eb;
            font-size: 0.9rem;
        }

        .subject-table tr:hover {
            background: #f9fafb;
        }

        .subject-table tr.selected {
            background: #dbeafe;
        }

        .subject-table tr.selected:hover {
            background: #bfdbfe;
        }

        .units-badge {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .units-regular { background: #dbeafe; color: #1e40af; }
        .units-lab { background: #fce7f3; color: #be185d; }
        .units-thesis { background: #fef3c7; color: #92400e; }

        /* ==================== PAYMENT SUMMARY ==================== */
        .payment-summary {
            background: #f8fafc;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .summary-label {
            color: var(--gray);
            font-size: 0.9rem;
        }

        .summary-value {
            font-weight: 600;
            color: var(--dark);
        }

        .summary-total {
            border-top: 2px solid #e5e7eb;
            padding-top: 10px;
            margin-top: 10px;
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--primary);
        }

        /* ==================== STATUS CARD ==================== */
        .status-card {
            padding: 25px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
        }

        .status-card.pending {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
        }

        .status-card.approved {
            background: #d1fae5;
            border-left: 4px solid #10b981;
        }

        .status-card.rejected {
            background: #fee2e2;
            border-left: 4px solid #ef4444;
        }

        .status-card.completed {
            background: #dbeafe;
            border-left: 4px solid #3b82f6;
        }

        .status-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .status-card.pending .status-icon { color: #f59e0b; }
        .status-card.approved .status-icon { color: #10b981; }
        .status-card.rejected .status-icon { color: #ef4444; }
        .status-card.completed .status-icon { color: #3b82f6; }

        .status-title {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .status-message {
            color: var(--gray);
            margin-bottom: 20px;
            line-height: 1.6;
        }

        /* ==================== ACTION BUTTONS ==================== */
        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        /* ==================== PAYMENT OPTIONS ==================== */
        .payment-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .payment-option {
            padding: 20px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .payment-option:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .payment-option.selected {
            border-color: var(--primary);
            background: rgba(67, 97, 238, 0.05);
        }

        .payment-icon {
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 10px;
        }

        .payment-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .payment-description {
            font-size: 0.85rem;
            color: var(--gray);
        }

        /* ==================== STEP CONTENT ==================== */
        .step-content {
            padding: 30px;
            display: none;
        }

        .step-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        /* ==================== ALERT BOX ==================== */
        .alert-box {
            padding: 15px 20px;
            border-radius: 8px;
            margin: 20px 0;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .alert-box.warning {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            color: #92400e;
        }

        .alert-box.info {
            background: #dbeafe;
            border-left: 4px solid #3b82f6;
            color: #1e40af;
        }

        .alert-box.success {
            background: #d1fae5;
            border-left: 4px solid #10b981;
            color: #065f46;
        }

        .alert-box.danger {
            background: #fee2e2;
            border-left: 4px solid #ef4444;
            color: #991b1b;
        }

        .alert-icon {
            font-size: 1.5rem;
        }

        .alert-content {
            flex: 1;
        }

        .alert-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        /* ==================== BALANCE TABLE STYLES ==================== */
        .balance-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .balance-table th {
            background: #f3f4f6;
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
            color: var(--dark);
            border-bottom: 2px solid #e5e7eb;
            font-size: 0.9rem;
        }

        .balance-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e5e7eb;
            font-size: 0.9rem;
        }

        .balance-table .amount {
            text-align: right;
            font-weight: 600;
        }

        .balance-table .positive {
            color: #10b981;
        }

        .balance-table .negative {
            color: #ef4444;
        }

        /* ==================== REGISTRATION STATUS ==================== */
        .registration-status {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .status-item {
            background: white;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            border: 1px solid #e5e7eb;
            transition: all 0.3s ease;
        }

        .status-item:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow);
        }

        .status-item.completed {
            border-color: #10b981;
            background: #d1fae5;
        }

        .status-item.pending {
            border-color: #f59e0b;
            background: #fef3c7;
        }

        .status-item.not-started {
            border-color: #d1d5db;
            background: #f9fafb;
        }

        .status-item.rejected {
            border-color: #ef4444;
            background: #fee2e2;
        }

        .status-icon-small {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .status-item.completed .status-icon-small { color: #10b981; }
        .status-item.pending .status-icon-small { color: #f59e0b; }
        .status-item.not-started .status-icon-small { color: #9ca3af; }
        .status-item.rejected .status-icon-small { color: #ef4444; }

        .status-item-title {
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 1rem;
        }

        .status-item-desc {
            font-size: 0.85rem;
            color: var(--gray);
        }

        /* ==================== PHOTO & SIGNATURE STYLES ==================== */
        .photo-signature-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 20px 0;
        }

        .photo-upload-area, .signature-upload-area {
            background: #f8fafc;
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .photo-upload-area:hover, .signature-upload-area:hover {
            border-color: var(--primary);
            background: rgba(67, 97, 238, 0.05);
        }

        .upload-icon {
            font-size: 3rem;
            color: var(--primary);
            margin-bottom: 15px;
        }

        .upload-preview {
            width: 150px;
            height: 180px;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 4px;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .signature-preview {
            width: 250px;
            height: 100px;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 4px;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        /* ==================== EXAM PERMIT STYLES ==================== */
        .exam-permit-card {
            background: white;
            border: 2px solid #3b82f6;
            border-radius: 8px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: var(--shadow-lg);
        }

        .permit-header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e5e7eb;
        }

        .permit-title {
            color: #1e40af;
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .permit-university {
            font-size: 1.2rem;
            color: var(--dark);
            margin-bottom: 5px;
        }

        .permit-validity {
            color: #ef4444;
            font-weight: 600;
            margin-top: 10px;
        }

        .permit-details {
            margin: 20px 0;
        }

        .detail-row {
            display: flex;
            margin-bottom: 10px;
        }

        .detail-label {
            width: 180px;
            font-weight: 600;
            color: var(--dark);
        }

        .detail-value {
            flex: 1;
            color: var(--gray);
        }

        .permit-qr {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background: #f8fafc;
            border-radius: 8px;
        }

        .qr-placeholder {
            width: 150px;
            height: 150px;
            background: #e5e7eb;
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
        }

        /* ==================== DEFERMENT STYLES ==================== */
        .deferment-form {
            background: #f8fafc;
            border-radius: 8px;
            padding: 25px;
            margin: 20px 0;
        }

        .reason-options {
            margin: 15px 0;
        }

        .reason-option {
            margin-bottom: 10px;
        }

        /* ==================== GRADES TABLE STYLES ==================== */
        .grade-excellent { color: #10b981; font-weight: bold; }
        .grade-good { color: #3b82f6; font-weight: bold; }
        .grade-fair { color: #f59e0b; font-weight: bold; }
        .grade-poor { color: #ef4444; font-weight: bold; }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.85rem;
            color: var(--gray);
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .legend-excellent { background: #10b981; }
        .legend-good { background: #3b82f6; }
        .legend-fair { background: #f59e0b; }
        .legend-poor { background: #ef4444; }

        /* ==================== OVERALL RESULT STYLES ==================== */
        .overall-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .stat-box {
            background: white;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            border: 1px solid #e5e7eb;
            transition: all 0.3s ease;
        }

        .stat-box:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            margin: 10px 0;
            color: var(--primary);
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--gray);
        }

        /* ==================== CLASS SCHEDULE STYLES ==================== */
        .schedule-table-container {
            margin: 20px 0;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            overflow-x: auto;
        }

        .schedule-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }

        .schedule-table th {
            background: #f3f4f6;
            padding: 12px 15px;
            text-align: center;
            font-weight: 600;
            color: var(--dark);
            border-bottom: 2px solid #e5e7eb;
            font-size: 0.9rem;
        }

        .schedule-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e5e7eb;
            font-size: 0.9rem;
            text-align: center;
        }

        .schedule-table .time-slot {
            font-weight: 600;
            background: #f8fafc;
        }

        .schedule-table .subject-cell {
            background: #e0f2fe;
            border: 1px solid #93c5fd;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .schedule-table .subject-cell:hover {
            background: #dbeafe;
            transform: scale(1.02);
        }

        /* ==================== EXAM SCHEDULE STYLES ==================== */
        .exam-schedule-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .exam-schedule-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .exam-subject {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .exam-details {
            display: flex;
            gap: 20px;
            font-size: 0.9rem;
            color: var(--gray);
        }

        /* ==================== ACADEMIC YEAR SELECTOR STYLES ==================== */
        .academic-year-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .academic-year-selector .year-btn {
            padding: 8px 16px;
            border: 2px solid #e5e7eb;
            background: white;
            color: var(--gray);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .academic-year-selector .year-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .academic-year-selector .year-btn.active {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        .academic-year-selector .year-btn.completed {
            background: #d1fae5;
            border-color: #10b981;
            color: #065f46;
        }

        .academic-year-selector .year-btn.current {
            background: #dbeafe;
            border-color: #3b82f6;
            color: #1e40af;
        }

        /* ==================== SEMESTER TABS ==================== */
        .semester-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .semester-tab {
            padding: 10px 20px;
            border: 2px solid #e5e7eb;
            background: white;
            color: var(--gray);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .semester-tab:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .semester-tab.active {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        /* ==================== GRADE LEGEND ==================== */
        .grade-legend {
            display: flex;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
            justify-content: center;
        }

        .grade-legend .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* ==================== RESPONSIVE ==================== */
        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                width: 98%;
                margin: 10px auto;
            }
            
            .profile-nav {
                flex-wrap: wrap;
            }
            
            .profile-nav-item {
                flex: 1;
                min-width: 120px;
                justify-content: center;
            }
            
            .stepper {
                flex-wrap: wrap;
            }
            
            .step:not(:last-child)::after {
                display: none;
            }
            
            .photo-signature-container {
                grid-template-columns: 1fr;
            }
            
            .academic-year-selector {
                justify-content: center;
            }
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .logo-area {
                justify-content: center;
            }
            
            .course-info {
                justify-content: center;
            }
            
            .user-info {
                flex-direction: column;
            }
            
            .service-grid, .academic-grid {
                grid-template-columns: 1fr;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .profile-content {
                padding: 15px;
            }
            
            .step-content {
                padding: 15px;
            }
            
            .data-table, .subject-table, .balance-table {
                display: block;
                overflow-x: auto;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .detail-row {
                flex-direction: column;
            }
            
            .detail-label {
                width: 100%;
                margin-bottom: 5px;
            }
            
            .grade-legend {
                flex-direction: column;
                align-items: center;
            }
        }

        @media (max-width: 480px) {
            .calendar-day {
                font-size: 0.7rem;
            }
            
            .profile-nav-item {
                min-width: 100px;
                padding: 10px 5px;
                font-size: 0.85rem;
            }
            
            .upload-preview {
                width: 120px;
                height: 150px;
            }
            
            .signature-preview {
                width: 200px;
                height: 80px;
            }
            
            .academic-year-selector .year-btn {
                padding: 6px 12px;
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Connection Status Banner -->
        <div class="connection-banner" id="connectionBanner">
            <i class="fas fa-circle"></i>
            <span id="bannerText">Loading...</span>
        </div>

        <!-- Error/Success Messages -->
        <div class="error-message" id="errorMessage"></div>
        <div class="success-message" id="successMessage"></div>

        <!-- Header -->
        <div class="header">
            <div class="logo-area">
                <div class="logo" id="logo-home">
                    <i class="fas fa-graduation-cap logo-icon"></i>
                    <span>LearnGate Portal</span>
                </div>
                <div class="course-info">
                    <div class="course-name">
                        <i class="fas fa-book"></i>
                        <span id="currentCourse">Student Dashboard</span>
                    </div>
                    <div class="course-code">
                        <i class="fas fa-user-graduate"></i>
                        <span id="courseStatus">Status: Loading...</span>
                    </div>
                </div>
            </div>
            <div class="user-info">
                <div class="user-details">
                    <h4 id="userName">Welcome</h4>
                    <p id="userRole"><span id="statusText">Loading...</span></p>
                </div>
                <div class="user-avatar" id="userAvatar">S</div>
                <button class="logout-btn" onclick="logout()" title="Logout">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </div>

        <!-- Welcome Banner -->
        <div class="welcome-banner" id="welcomeBanner" style="display: none;">
            <div class="welcome-text">
                <h2>Welcome, <span id="welcomeName">Student</span>!</h2>
                <p id="welcomeMessage">Loading your dashboard...</p>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Left Column -->
            <div>
                <!-- Student Services (Collapsible) -->
                <div class="card">
                    <div class="section-title" id="studentServicesToggle" onclick="toggleSection('studentServices')">
                        <i class="fas fa-chevron-down"></i>
                        <i class="fas fa-user-graduate"></i>
                        <span>Student Services</span>
                    </div>
                    <div class="collapsible-content" id="studentServicesContent">
                        <div class="service-grid">
                            <div class="info-card" id="programCard">
                                <div class="label">Program</div>
                                <div class="value" id="studentProgram">Loading...</div>
                            </div>
                            <div class="info-card">
                                <div class="label">Student ID</div>
                                <div class="value" id="studentId">Loading...</div>
                            </div>
                            <div class="info-card">
                                <div class="label">Year Level</div>
                                <div class="value" id="studentYear">Loading...</div>
                            </div>
                            <div class="info-card">
                                <div class="label">GPA</div>
                                <div class="value" id="studentGPA">Loading...</div>
                            </div>
                        </div>

                        <div class="service-grid" style="margin-top: 20px;">
                            <button class="btn btn-outline" onclick="openStudentProfile()">
                                <i class="fas fa-user-circle"></i> Student Profile
                            </button>
                            <button class="btn btn-outline" onclick="openCourseEnlistment()">
                                <i class="fas fa-clipboard-list"></i> Course Enlistment
                            </button>
                            <button class="btn btn-outline" onclick="openMyPayment()">
                                <i class="fas fa-file-invoice-dollar"></i> My Payment
                            </button>
                            <button class="btn btn-outline" onclick="viewSchedule()">
                                <i class="fas fa-calendar-alt"></i> View Schedule
                            </button>
                            <button class="btn btn-outline" onclick="openSubjectCompletion()">
                                <i class="fas fa-certificate"></i> Subject Completion
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Academic Activities (Collapsible) -->
                <div class="card">
                    <div class="section-title" id="academicActivitiesToggle" onclick="toggleSection('academicActivities')">
                        <i class="fas fa-chevron-down"></i>
                        <i class="fas fa-graduation-cap"></i>
                        <span>Academic Activities</span>
                    </div>
                    <div class="collapsible-content" id="academicActivitiesContent">
                        <div class="academic-grid">
                            <button class="btn btn-secondary" onclick="openAddDropSubject()">
                                <i class="fas fa-exchange-alt"></i> Add/Drop Subject
                            </button>
                            <button class="btn btn-secondary" onclick="openStudentRequest()">
                                <i class="fas fa-comment-alt"></i> Student Request
                            </button>
                            <button class="btn btn-secondary" onclick="openAssignmentPortal()">
                                <i class="fas fa-tasks"></i> Assignment Portal
                            </button>
                            <button class="btn btn-secondary" onclick="openExaminationSchedule()">
                                <i class="fas fa-file-alt"></i> Examinations
                            </button>
                            <button class="btn btn-secondary" onclick="openLibraryAccess()">
                                <i class="fas fa-book-reader"></i> Library Access
                            </button>
                            <button class="btn btn-secondary" onclick="openResearchPortal()">
                                <i class="fas fa-flask"></i> Research Portal
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Current Subjects -->
                <div class="card">
                    <div class="section-title">
                        <i class="fas fa-book"></i>
                        <span>Current Subjects</span>
                    </div>
                    <div id="currentSubjects">
                        <div style="text-align: center; padding: 20px; color: var(--gray);">
                            Loading subjects...
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column -->
            <div>
                <!-- Calendar Card -->
                <div class="card">
                    <div class="section-title">
                        <i class="fas fa-calendar-alt"></i>
                        <span>Academic Calendar</span>
                        <button class="btn btn-sm btn-gray" onclick="refreshCalendar()" style="margin-left: auto;">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                    </div>
                    
                    <div class="calendar-container" id="calendarContainer">
                        <!-- Calendar will be rendered here -->
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="card">
                    <div class="section-title">
                        <i class="fas fa-bolt"></i>
                        <span>Quick Actions</span>
                    </div>
                    
                    <div style="display: flex; flex-direction: column; gap: 10px;">
                        <button class="btn btn-outline" onclick="openDownPayment()">
                            <i class="fas fa-money-check-alt"></i> Down Payment
                        </button>
                        <button class="btn btn-outline" onclick="openAttendanceTracker()">
                            <i class="fas fa-user-check"></i> Attendance Tracker
                        </button>
                        <button class="btn btn-outline" onclick="openDownloadDocuments()">
                            <i class="fas fa-download"></i> Download Documents
                        </button>
                        <button class="btn btn-outline" onclick="openCampusResources()">
                            <i class="fas fa-university"></i> Campus Resources
                        </button>
                        <button class="btn btn-outline" onclick="openStudentClubs()">
                            <i class="fas fa-users"></i> Student Clubs
                        </button>
                        <button class="btn btn-outline" onclick="openHealthServices()">
                            <i class="fas fa-heartbeat"></i> Health Services
                        </button>
                    </div>
                </div>

                <!-- Notifications -->
                <div class="card">
                    <div class="section-title">
                        <i class="fas fa-bell"></i>
                        <span>Notifications</span>
                        <button class="btn btn-sm btn-gray" onclick="loadNotifications()" style="margin-left: auto;">
                            <i class="fas fa-sync-alt"></i> Refresh
                        </button>
                    </div>
                    <div id="notificationsList" style="max-height: 200px; overflow-y: auto;">
                        <div class="notification-item" style="text-align: center; padding: 20px; color: var(--gray);">
                            Loading notifications...
                        </div>
                    </div>
                </div>

                <!-- Real-time Updates -->
                <div class="card">
                    <div class="section-title">
                        <i class="fas fa-sync-alt"></i>
                        <span>System Status</span>
                    </div>
                    <div style="text-align: center; padding: 15px;">
                        <div style="font-size: 0.9rem; color: var(--gray); margin-bottom: 5px;">Last Updated</div>
                        <div style="font-weight: 500; color: var(--success);" id="lastUpdateTime">Just now</div>
                        <div style="font-size: 0.8rem; color: var(--gray); margin-top: 5px;" id="docCount">All systems operational</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading Spinner -->
        <div id="loadingSpinner" class="loading">
            <div class="spinner"></div>
            <div style="margin-top: 15px; color: var(--gray);" id="loadingText">Initializing Dashboard...</div>
        </div>
    </div>

    <!-- Subject Completion Modal (UPDATED) -->
    <div id="subjectCompletionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-certificate"></i> Subject Completion (INC)</h2>
                <button class="modal-close" onclick="closeSubjectCompletion()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="subject-completion-section">
                    <!-- Student Information Header -->
                    <div class="student-info-header">
                        <h3 style="margin-bottom: 20px; color: white;">Student Information</h3>
                        <div class="student-info-grid">
                            <div class="student-info-item">
                                <div class="student-info-label">Student ID</div>
                                <div class="student-info-value" id="completionStudentId">2023-001234</div>
                            </div>
                            <div class="student-info-item">
                                <div class="student-info-label">Student Name</div>
                                <div class="student-info-value" id="completionStudentName">JUAN DELA CRUZ</div>
                            </div>
                            <div class="student-info-item">
                                <div class="student-info-label">Campus</div>
                                <div class="student-info-value" id="completionCampus">Main Campus</div>
                            </div>
                            <div class="student-info-item">
                                <div class="student-info-label">College</div>
                                <div class="student-info-value" id="completionCollege">College of Computer Studies</div>
                            </div>
                            <div class="student-info-item">
                                <div class="student-info-label">Program</div>
                                <div class="student-info-value" id="completionProgram">BS Information Technology</div>
                            </div>
                            <div class="student-info-item">
                                <div class="student-info-label">Year Level</div>
                                <div class="student-info-value" id="completionYearLevel">3rd Year</div>
                            </div>
                        </div>
                    </div>

                    <!-- INC Subjects Table -->
                    <div class="section-title-modal">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span>Incomplete (INC) Subjects</span>
                    </div>
                    
                    <div class="alert-box warning">
                        <div class="alert-icon">
                            <i class="fas fa-exclamation-circle"></i>
                        </div>
                        <div class="alert-content">
                            <div class="alert-title">Important Notice</div>
                            <div>You have <strong id="incCount">2</strong> incomplete subjects. Please complete all requirements before the deadline.</div>
                        </div>
                    </div>
                    
                    <div class="inc-subjects-table-container">
                        <table class="inc-subjects-table">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Subject Code</th>
                                    <th>Subject Name</th>
                                    <th>Units</th>
                                    <th>Academic Session</th>
                                    <th>INC Start Date</th>
                                    <th>INC End Date</th>
                                    <th>Days Remaining</th>
                                    <th>Status</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="incSubjectsTableBody">
                                <!-- INC Subjects will be populated here -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Completion Requirements -->
                    <div class="section-title-modal" style="margin-top: 30px;">
                        <i class="fas fa-clipboard-check"></i>
                        <span>Completion Requirements</span>
                    </div>
                    
                    <div class="completion-instructions">
                        <h4><i class="fas fa-info-circle"></i> Instructions for Completing INC Subjects</h4>
                        <ul>
                            <li>Complete all pending requirements listed below</li>
                            <li>Submit requirements to the course instructor or department</li>
                            <li>Get acknowledgment receipt for submitted requirements</li>
                            <li>Instructor will update your grade within 7 working days</li>
                            <li>Monitor your grade status in the Grades section</li>
                            <li>INC subjects must be completed within one academic year</li>
                        </ul>
                    </div>
                    
                    <div class="requirements-grid" id="completionRequirementsGrid">
                        <!-- Requirements will be populated here -->
                    </div>

                    <!-- Completion Form -->
                    <div class="completion-form">
                        <div class="section-title-modal">
                            <i class="fas fa-paper-plane"></i>
                            <span>Submit Completion Request</span>
                        </div>
                        
                        <form id="completionRequestForm">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">Select Subject *</label>
                                    <select class="form-select" id="subjectToComplete" required>
                                        <option value="">Select Subject</option>
                                        <!-- Options will be populated dynamically -->
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Submission Date *</label>
                                    <input type="date" class="form-control" id="submissionDate" required>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Method of Submission *</label>
                                <div style="margin-top: 10px;">
                                    <div class="form-check">
                                        <input type="radio" class="form-check-input" name="submissionMethod" id="methodOnline" value="Online" required>
                                        <label class="form-check-label" for="methodOnline">Online Submission (Email/LMS)</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="radio" class="form-check-input" name="submissionMethod" id="methodInPerson" value="In Person" required>
                                        <label class="form-check-label" for="methodInPerson">In-Person Submission (Department Office)</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="radio" class="form-check-input" name="submissionMethod" id="methodBoth" value="Both" required>
                                        <label class="form-check-label" for="methodBoth">Both Online and In-Person</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Instructor's Name *</label>
                                <input type="text" class="form-control" id="instructorName" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Instructor's Email *</label>
                                <input type="email" class="form-control" id="instructorEmail" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Remarks/Notes</label>
                                <textarea class="form-control" id="completionRemarks" rows="3" placeholder="Additional information about your completion request..."></textarea>
                            </div>
                            
                            <div class="alert-box info">
                                <div class="alert-icon">
                                    <i class="fas fa-info-circle"></i>
                                </div>
                                <div class="alert-content">
                                    <div class="alert-title">Submission Guidelines</div>
                                    <div>
                                        <ul style="margin: 10px 0 0 20px; font-size: 0.9rem;">
                                            <li>Keep copies of all submitted documents</li>
                                            <li>Get acknowledgment receipt for in-person submissions</li>
                                            <li>Save email confirmations for online submissions</li>
                                            <li>Follow up with instructor after 3 working days</li>
                                            <li>Contact department if not updated after 7 days</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="btn btn-gray" onclick="closeSubjectCompletion()">Cancel</button>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-paper-plane"></i> Submit Completion Request
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Attendance Tracker Modal -->
    <div id="attendanceModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-user-check"></i> Attendance Tracker</h2>
                <button class="modal-close" onclick="closeAttendanceModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="attendance-section">
                    <!-- Current Subject Selector -->
                    <div style="margin-bottom: 25px;">
                        <div class="section-title-modal">
                            <i class="fas fa-book"></i>
                            <span>Select Subject</span>
                        </div>
                        <select class="form-control" id="attendanceSubject" onchange="loadAttendanceData()" style="max-width: 400px;">
                            <option value="IT301">IT 301 - Web Development</option>
                            <option value="IT302">IT 302 - Database Systems</option>
                            <option value="CS201">CS 201 - Data Structures</option>
                        </select>
                    </div>

                    <!-- Attendance Statistics -->
                    <div class="attendance-stats">
                        <div class="stat-card">
                            <div class="label">Total Classes</div>
                            <div class="stat-value">42</div>
                        </div>
                        <div class="stat-card">
                            <div class="label">Present</div>
                            <div class="stat-value stat-present">38</div>
                            <div class="label">(90.5%)</div>
                        </div>
                        <div class="stat-card">
                            <div class="label">Absent</div>
                            <div class="stat-value stat-absent">3</div>
                            <div class="label">(7.1%)</div>
                        </div>
                        <div class="stat-card">
                            <div class="label">Late</div>
                            <div class="stat-value stat-late">1</div>
                            <div class="label">(2.4%)</div>
                        </div>
                    </div>

                    <!-- Attendance Table -->
                    <div class="section-title-modal" style="margin-top: 30px;">
                        <i class="fas fa-calendar-alt"></i>
                        <span>Attendance History</span>
                    </div>
                    
                    <div class="attendance-table-container">
                        <table class="attendance-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Day</th>
                                    <th>Time</th>
                                    <th>Status</th>
                                    <th>Remarks</th>
                                </tr>
                            </thead>
                            <tbody id="attendanceTableBody">
                                <!-- Attendance records will be populated here -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Actions -->
                    <div style="display: flex; justify-content: space-between; margin-top: 30px; padding-top: 20px; border-top: 1px solid #e5e7eb;">
                        <button type="button" class="btn btn-gray" onclick="closeAttendanceModal()">
                            <i class="fas fa-times"></i> Close
                        </button>
                        <div style="display: flex; gap: 10px;">
                            <button type="button" class="btn btn-outline" onclick="printAttendance()">
                                <i class="fas fa-print"></i> Print Report
                            </button>
                            <button type="button" class="btn btn-primary" onclick="requestAttendanceCorrection()">
                                <i class="fas fa-edit"></i> Request Correction
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Download Documents Modal -->
    <div id="documentsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-download"></i> Download Documents</h2>
                <button class="modal-close" onclick="closeDocumentsModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="documents-section">
                    <!-- Document Categories -->
                    <div style="margin-bottom: 25px;">
                        <div class="section-title-modal">
                            <i class="fas fa-folder"></i>
                            <span>Document Categories</span>
                        </div>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px;">
                            <button class="year-btn active" onclick="filterDocuments('all')">All Documents</button>
                            <button class="year-btn" onclick="filterDocuments('academic')">Academic</button>
                            <button class="year-btn" onclick="filterDocuments('financial')">Financial</button>
                            <button class="year-btn" onclick="filterDocuments('legal')">Legal</button>
                            <button class="year-btn" onclick="filterDocuments('others')">Others</button>
                        </div>
                    </div>

                    <!-- Documents Grid -->
                    <div class="documents-grid" id="documentsGrid">
                        <!-- Documents will be populated here -->
                    </div>

                    <!-- Actions -->
                    <div style="display: flex; justify-content: space-between; margin-top: 30px; padding-top: 20px; border-top: 1px solid #e5e7eb;">
                        <button type="button" class="btn btn-gray" onclick="closeDocumentsModal()">
                            <i class="fas fa-times"></i> Close
                        </button>
                        <button type="button" class="btn btn-primary" onclick="refreshDocuments()">
                            <i class="fas fa-sync-alt"></i> Refresh Documents
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Campus Resources Modal -->
    <div id="resourcesModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-university"></i> Campus Resources</h2>
                <button class="modal-close" onclick="closeResourcesModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="resources-section">
                    <!-- Library Resources -->
                    <div class="resource-category">
                        <div class="category-title">
                            <i class="fas fa-book"></i> Library Resources
                        </div>
                        <div class="resources-grid">
                            <div class="resource-card">
                                <div class="resource-icon">
                                    <i class="fas fa-book-open"></i>
                                </div>
                                <div class="resource-name">Main Library</div>
                                <div class="resource-desc">Access to over 50,000 books, journals, and digital resources</div>
                                <div class="resource-status status-open">Open 8:00 AM - 9:00 PM</div>
                            </div>
                            <div class="resource-card">
                                <div class="resource-icon">
                                    <i class="fas fa-laptop-code"></i>
                                </div>
                                <div class="resource-name">Computer Lab</div>
                                <div class="resource-desc">50 computers with specialized software for students</div>
                                <div class="resource-status status-open">Open 7:00 AM - 10:00 PM</div>
                            </div>
                            <div class="resource-card">
                                <div class="resource-icon">
                                    <i class="fas fa-headphones"></i>
                                </div>
                                <div class="resource-name">Audio-Visual Room</div>
                                <div class="resource-desc">Soundproof rooms for group study and presentations</div>
                                <div class="resource-status status-open">Open 9:00 AM - 8:00 PM</div>
                            </div>
                        </div>
                    </div>

                    <!-- Sports Facilities -->
                    <div class="resource-category">
                        <div class="category-title">
                            <i class="fas fa-running"></i> Sports Facilities
                        </div>
                        <div class="resources-grid">
                            <div class="resource-card">
                                <div class="resource-icon">
                                    <i class="fas fa-basketball-ball"></i>
                                </div>
                                <div class="resource-name">Basketball Court</div>
                                <div class="resource-desc">Indoor court with professional flooring and lighting</div>
                                <div class="resource-status status-open">Open 6:00 AM - 10:00 PM</div>
                            </div>
                            <div class="resource-card">
                                <div class="resource-icon">
                                    <i class="fas fa-swimmer"></i>
                                </div>
                                <div class="resource-name">Swimming Pool</div>
                                <div class="resource-desc">Olympic-sized pool with lifeguards on duty</div>
                                <div class="resource-status status-open">Open 7:00 AM - 7:00 PM</div>
                            </div>
                            <div class="resource-card">
                                <div class="resource-icon">
                                    <i class="fas fa-dumbbell"></i>
                                </div>
                                <div class="resource-name">Gymnasium</div>
                                <div class="resource-desc">Fully equipped gym with trainers available</div>
                                <div class="resource-status status-open">Open 5:00 AM - 11:00 PM</div>
                            </div>
                        </div>
                    </div>

                    <!-- Study Areas -->
                    <div class="resource-category">
                        <div class="category-title">
                            <i class="fas fa-graduation-cap"></i> Study Areas
                        </div>
                        <div class="resources-grid">
                            <div class="resource-card">
                                <div class="resource-icon">
                                    <i class="fas fa-users"></i>
                                </div>
                                <div class="resource-name">Group Study Rooms</div>
                                <div class="resource-desc">Bookable rooms for group discussions and projects</div>
                                <div class="resource-status status-open">Reservation Required</div>
                            </div>
                            <div class="resource-card">
                                <div class="resource-icon">
                                    <i class="fas fa-user"></i>
                                </div>
                                <div class="resource-name">Silent Study Zone</div>
                                <div class="resource-desc">Designated quiet area for individual study</div>
                                <div class="resource-status status-open">Open 24/7</div>
                            </div>
                            <div class="resource-card">
                                <div class="resource-icon">
                                    <i class="fas fa-coffee"></i>
                                </div>
                                <div class="resource-name">Student Lounge</div>
                                <div class="resource-desc">Comfortable seating with charging stations and WiFi</div>
                                <div class="resource-status status-open">Open 6:00 AM - 12:00 AM</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Student Clubs Modal -->
    <div id="clubsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-users"></i> Student Clubs</h2>
                <button class="modal-close" onclick="closeClubsModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="clubs-section">
                    <div class="clubs-grid" id="clubsGrid">
                        <!-- Clubs will be populated here -->
                    </div>

                    <!-- Actions -->
                    <div style="display: flex; justify-content: space-between; margin-top: 30px; padding-top: 20px; border-top: 1px solid #e5e7eb;">
                        <button type="button" class="btn btn-gray" onclick="closeClubsModal()">
                            <i class="fas fa-times"></i> Close
                        </button>
                        <div style="display: flex; gap: 10px;">
                            <button type="button" class="btn btn-outline" onclick="browseAllClubs()">
                                <i class="fas fa-search"></i> Browse All Clubs
                            </button>
                            <button type="button" class="btn btn-primary" onclick="createNewClub()">
                                <i class="fas fa-plus"></i> Create New Club
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Health Services Modal -->
    <div id="healthModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-heartbeat"></i> Health Services</h2>
                <button class="modal-close" onclick="closeHealthModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="health-section">
                    <!-- Health Services -->
                    <div class="health-services-grid" id="healthServicesGrid">
                        <!-- Services will be populated here -->
                    </div>

                    <!-- Emergency Contacts -->
                    <div class="emergency-contacts">
                        <div class="emergency-title">
                            <i class="fas fa-exclamation-triangle"></i> Emergency Contacts
                        </div>
                        <div class="contact-list">
                            <div class="contact-item">
                                <div class="contact-icon">
                                    <i class="fas fa-phone-alt"></i>
                                </div>
                                <div>
                                    <div style="font-weight: 500;">Campus Security</div>
                                    <div style="font-size: 0.9rem; color: var(--gray);">(02) 1234-5678</div>
                                </div>
                            </div>
                            <div class="contact-item">
                                <div class="contact-icon">
                                    <i class="fas fa-ambulance"></i>
                                </div>
                                <div>
                                    <div style="font-weight: 500;">Emergency Ambulance</div>
                                    <div style="font-size: 0.9rem; color: var(--gray);">911</div>
                                </div>
                            </div>
                            <div class="contact-item">
                                <div class="contact-icon">
                                    <i class="fas fa-user-md"></i>
                                </div>
                                <div>
                                    <div style="font-weight: 500;">Campus Doctor</div>
                                    <div style="font-size: 0.9rem; color: var(--gray);">(02) 1234-5679</div>
                                </div>
                            </div>
                            <div class="contact-item">
                                <div class="contact-icon">
                                    <i class="fas fa-hospital"></i>
                                </div>
                                <div>
                                    <div style="font-weight: 500;">Nearest Hospital</div>
                                    <div style="font-size: 0.9rem; color: var(--gray);">St. Luke's Hospital</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Actions -->
                    <div style="display: flex; justify-content: space-between; margin-top: 30px; padding-top: 20px; border-top: 1px solid #e5e7eb;">
                        <button type="button" class="btn btn-gray" onclick="closeHealthModal()">
                            <i class="fas fa-times"></i> Close
                        </button>
                        <div style="display: flex; gap: 10px;">
                            <button type="button" class="btn btn-outline" onclick="scheduleAppointment()">
                                <i class="fas fa-calendar-check"></i> Schedule Appointment
                            </button>
                            <button type="button" class="btn btn-primary" onclick="reportEmergency()">
                                <i class="fas fa-exclamation-circle"></i> Report Emergency
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Student Profile Modal -->
    <div id="studentProfileModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-user-circle"></i> Student Profile</h2>
                <button class="modal-close" onclick="closeStudentProfile()">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Profile Navigation -->
                <div class="profile-nav" id="profileNav">
                    <button class="profile-nav-item active" data-section="personal" onclick="showProfileSection('personal')">
                        <i class="fas fa-user"></i> Personal Details
                    </button>
                    <button class="profile-nav-item" data-section="family" onclick="showProfileSection('family')">
                        <i class="fas fa-users"></i> Family Details
                    </button>
                    <button class="profile-nav-item" data-section="address" onclick="showProfileSection('address')">
                        <i class="fas fa-home"></i> Address Details
                    </button>
                    <button class="profile-nav-item" data-section="course" onclick="showProfileSection('course')">
                        <i class="fas fa-graduation-cap"></i> Course Details
                    </button>
                    <button class="profile-nav-item" data-section="photo" onclick="showProfileSection('photo')">
                        <i class="fas fa-camera"></i> Photo & Signature
                    </button>
                    <button class="profile-nav-item" data-section="enlisted" onclick="showProfileSection('enlisted')">
                        <i class="fas fa-clipboard-list"></i> Enlisted Subjects
                    </button>
                    <button class="profile-nav-item" data-section="grades" onclick="showProfileSection('grades')">
                        <i class="fas fa-chart-line"></i> Grades
                    </button>
                    <button class="profile-nav-item" data-section="schedule" onclick="showProfileSection('schedule')">
                        <i class="fas fa-calendar-alt"></i> Class Schedule
                    </button>
                    <button class="profile-nav-item" data-section="attendance" onclick="showProfileSection('attendance')">
                        <i class="fas fa-user-check"></i> Attendance
                    </button>
                    <button class="profile-nav-item" data-section="overall" onclick="showProfileSection('overall')">
                        <i class="fas fa-chart-bar"></i> Overall Result
                    </button>
                    <button class="profile-nav-item" data-section="exam-permit" onclick="showProfileSection('exam-permit')">
                        <i class="fas fa-file-alt"></i> Exam Permit
                    </button>
                    <button class="profile-nav-item" data-section="documents" onclick="showProfileSection('documents')">
                        <i class="fas fa-folder"></i> Documents
                    </button>
                    <button class="profile-nav-item" data-section="exam-schedule" onclick="showProfileSection('exam-schedule')">
                        <i class="fas fa-calendar-times"></i> Exam Schedule
                    </button>
                    <button class="profile-nav-item" data-section="deferment" onclick="showProfileSection('deferment')">
                        <i class="fas fa-clock"></i> Apply Deferment
                    </button>
                </div>

                <!-- Profile Content Sections -->
                <div class="profile-content">
                    <!-- Personal Details Section -->
                    <div class="profile-section active" id="personal-section">
                        <div class="section-title-modal">
                            <i class="fas fa-user"></i> Personal Details
                        </div>
                        <form id="personalDetailsForm">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">Last Name *</label>
                                    <input type="text" class="form-control" id="lastName" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">First Name *</label>
                                    <input type="text" class="form-control" id="firstName" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Middle Name</label>
                                    <input type="text" class="form-control" id="middleName">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Extension Name</label>
                                    <select class="form-select" id="extensionName">
                                        <option value="">Select...</option>
                                        <option value="Jr.">Jr.</option>
                                        <option value="Sr.">Sr.</option>
                                        <option value="II">II</option>
                                        <option value="III">III</option>
                                        <option value="IV">IV</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">Gender *</label>
                                    <select class="form-select" id="gender" required>
                                        <option value="">Select Gender</option>
                                        <option value="Male">Male</option>
                                        <option value="Female">Female</option>
                                        <option value="Other">Other</option>
                                        <option value="Prefer not to say">Prefer not to say</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Date of Birth *</label>
                                    <input type="date" class="form-control" id="dob" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Place of Birth *</label>
                                    <input type="text" class="form-control" id="placeOfBirth" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Civil Status *</label>
                                    <select class="form-select" id="civilStatus" required>
                                        <option value="">Select Status</option>
                                        <option value="Single">Single</option>
                                        <option value="Married">Married</option>
                                        <option value="Widowed">Widowed</option>
                                        <option value="Separated">Separated</option>
                                        <option value="Divorced">Divorced</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">Citizenship *</label>
                                    <input type="text" class="form-control" id="citizenship" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Dual Citizenship</label>
                                    <div>
                                        <div class="form-check">
                                            <input type="radio" class="form-check-input" name="dualCitizenship" id="dualYes" value="Yes">
                                            <label class="form-check-label" for="dualYes">Yes</label>
                                        </div>
                                        <div class="form-check">
                                            <input type="radio" class="form-check-input" name="dualCitizenship" id="dualNo" value="No" checked>
                                            <label class="form-check-label" for="dualNo">No</label>
                                        </div>
                                        <div class="form-check">
                                            <input type="radio" class="form-check-input" name="dualCitizenship" id="dualNotSpecify" value="Not Specify">
                                            <label class="form-check-label" for="dualNotSpecify">Not Specify</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Religion</label>
                                    <input type="text" class="form-control" id="religion">
                                </div>
                            </div>
                            
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">Student's Mobile No. *</label>
                                    <input type="tel" class="form-control" id="mobileNo" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Email Address *</label>
                                    <input type="email" class="form-control" id="email" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Facebook Name</label>
                                    <input type="text" class="form-control" id="facebookName">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Facebook Link</label>
                                    <input type="url" class="form-control" id="facebookLink">
                                </div>
                            </div>
                            
                            <div class="form-actions profile">
                                <button type="button" class="btn btn-gray" onclick="closeStudentProfile()">Cancel</button>
                                <button type="submit" class="btn btn-primary">Save Personal Details</button>
                            </div>
                        </form>
                    </div>

                    <!-- Family Details Section -->
                    <div class="profile-section" id="family-section">
                        <div class="section-title-modal">
                            <i class="fas fa-users"></i> Family Details
                        </div>
                        <form id="familyDetailsForm">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">Father's Full Name</label>
                                    <input type="text" class="form-control" id="fatherName">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Father's Occupation</label>
                                    <input type="text" class="form-control" id="fatherOccupation">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Father's Mobile No.</label>
                                    <input type="tel" class="form-control" id="fatherMobile">
                                </div>
                            </div>
                            
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">Mother's Full Name</label>
                                    <input type="text" class="form-control" id="motherName">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Mother's Occupation</label>
                                    <input type="text" class="form-control" id="motherOccupation">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Mother's Mobile No.</label>
                                    <input type="tel" class="form-control" id="motherMobile">
                                </div>
                            </div>
                            
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">Name of Spouse</label>
                                    <input type="text" class="form-control" id="spouseName">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Spouse Occupation</label>
                                    <input type="text" class="form-control" id="spouseOccupation">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Number of Children</label>
                                    <input type="number" class="form-control" id="childrenCount" min="0">
                                </div>
                            </div>
                            
                            <div class="section-title-modal" style="margin-top: 30px;">
                                <i class="fas fa-user-shield"></i> Guardian Information
                            </div>
                            
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">Name of Guardian</label>
                                    <input type="text" class="form-control" id="guardianName">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Relationship of Guardian</label>
                                    <input type="text" class="form-control" id="guardianRelationship">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Guardian's Mobile No.</label>
                                    <input type="tel" class="form-control" id="guardianMobile">
                                </div>
                            </div>
                            
                            <div class="form-actions profile">
                                <button type="button" class="btn btn-gray" onclick="closeStudentProfile()">Cancel</button>
                                <button type="submit" class="btn btn-primary">Save Family Details</button>
                            </div>
                        </form>
                    </div>

                    <!-- Address Details Section -->
                    <div class="profile-section" id="address-section">
                        <div class="section-title-modal">
                            <i class="fas fa-home"></i> Address Details
                        </div>
                        <form id="addressDetailsForm">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">Permanent Address *</label>
                                    <textarea class="form-control" id="permanentAddress" rows="3" required></textarea>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Current Address</label>
                                    <textarea class="form-control" id="currentAddress" rows="3"></textarea>
                                    <div class="form-check">
                                        <input type="checkbox" class="form-check-input" id="sameAsPermanent">
                                        <label class="form-check-label" for="sameAsPermanent">Same as permanent address</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">Province *</label>
                                    <input type="text" class="form-control" id="province" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">City/Municipality *</label>
                                    <input type="text" class="form-control" id="city" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Barangay *</label>
                                    <input type="text" class="form-control" id="barangay" required>
                                </div>
                            </div>
                            
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">Zip Code *</label>
                                    <input type="text" class="form-control" id="zipCode" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Country *</label>
                                    <input type="text" class="form-control" id="country" value="Philippines" required>
                                </div>
                            </div>
                            
                            <div class="form-actions profile">
                                <button type="button" class="btn btn-gray" onclick="closeStudentProfile()">Cancel</button>
                                <button type="submit" class="btn btn-primary">Save Address Details</button>
                            </div>
                        </form>
                    </div>

                    <!-- Course Details Section -->
                    <div class="profile-section" id="course-section">
                        <div class="section-title-modal">
                            <i class="fas fa-graduation-cap"></i> Course Details
                        </div>
                        <div class="info-card" style="margin-bottom: 20px;">
                            <div class="label">Academic Program</div>
                            <div class="value" id="profileProgram">Bachelor of Science in Information Technology</div>
                        </div>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Student ID</label>
                                <input type="text" class="form-control" value="2023-001234" readonly>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Year Level</label>
                                <input type="text" class="form-control" value="3rd Year" readonly>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Section</label>
                                <input type="text" class="form-control" value="BSIT-3A">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Academic Status</label>
                                <input type="text" class="form-control" value="Regular" readonly>
                            </div>
                        </div>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Date of Admission</label>
                                <input type="date" class="form-control" value="2021-08-15" readonly>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Expected Graduation</label>
                                <input type="date" class="form-control" value="2025-06-30" readonly>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Scholarship</label>
                                <select class="form-select" id="scholarship">
                                    <option value="">None</option>
                                    <option value="Academic Scholar">Academic Scholar</option>
                                    <option value="Athletic Scholar">Athletic Scholar</option>
                                    <option value="Cultural Scholar">Cultural Scholar</option>
                                    <option value="Government Scholar">Government Scholar</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-actions profile">
                            <button type="button" class="btn btn-gray" onclick="closeStudentProfile()">Cancel</button>
                            <button type="button" class="btn btn-primary" onclick="saveCourseDetails()">Save Course Details</button>
                        </div>
                    </div>

                    <!-- Photo & Signature Section -->
                    <div class="profile-section" id="photo-section">
                        <div class="section-title-modal">
                            <i class="fas fa-camera"></i> Photo & Signature
                        </div>
                        
                        <div class="photo-signature-container">
                            <!-- Student Photo -->
                            <div class="photo-upload-area">
                                <div class="upload-icon">
                                    <i class="fas fa-user-circle"></i>
                                </div>
                                <div class="upload-preview" id="photoPreview">
                                    <i class="fas fa-user" style="font-size: 3rem; color: #9ca3af;"></i>
                                </div>
                                <div style="margin-bottom: 15px;">
                                    <div style="font-weight: 600; margin-bottom: 5px;">Student Photo</div>
                                    <div style="font-size: 0.85rem; color: var(--gray);">
                                        Requirements: Recent 2x2 photo, JPEG/PNG format, Max 2MB
                                    </div>
                                </div>
                                <input type="file" id="photoUpload" accept="image/*" style="display: none;" onchange="previewPhoto(event)">
                                <button type="button" class="btn btn-outline" onclick="document.getElementById('photoUpload').click()">
                                    <i class="fas fa-upload"></i> Upload Photo
                                </button>
                            </div>
                            
                            <!-- Digital Signature -->
                            <div class="signature-upload-area">
                                <div class="upload-icon">
                                    <i class="fas fa-signature"></i>
                                </div>
                                <div class="signature-preview" id="signaturePreview">
                                    <i class="fas fa-signature" style="font-size: 2rem; color: #9ca3af;"></i>
                                </div>
                                <div style="margin-bottom: 15px;">
                                    <div style="font-weight: 600; margin-bottom: 5px;">Digital Signature</div>
                                    <div style="font-size: 0.85rem; color: var(--gray);">
                                        Requirements: PNG format with transparent background, Max 500KB
                                    </div>
                                </div>
                                <input type="file" id="signatureUpload" accept="image/*" style="display: none;" onchange="previewSignature(event)">
                                <button type="button" class="btn btn-outline" onclick="document.getElementById('signatureUpload').click()">
                                    <i class="fas fa-upload"></i> Upload Signature
                                </button>
                                <button type="button" class="btn btn-outline" onclick="createDigitalSignature()" style="margin-top: 10px;">
                                    <i class="fas fa-pen"></i> Create Digital Signature
                                </button>
                            </div>
                        </div>
                        
                        <div class="form-actions profile">
                            <button type="button" class="btn btn-gray" onclick="closeStudentProfile()">Cancel</button>
                            <button type="button" class="btn btn-primary" onclick="savePhotoSignature()">Save Photo & Signature</button>
                        </div>
                    </div>

                    <!-- Enlisted Subjects Section -->
                    <div class="profile-section" id="enlisted-section">
                        <div class="section-title-modal">
                            <i class="fas fa-clipboard-list"></i> Enlisted Subjects (Current Semester)
                        </div>
                        
                        <div class="info-card" style="margin-bottom: 20px; background: #f0f9ff; border-left-color: #0ea5e9;">
                            <div class="label">Current Semester</div>
                            <div class="value">1st Semester AY 2024-2025</div>
                        </div>
                        
                        <div class="subject-table-container">
                            <table class="subject-table">
                                <thead>
                                    <tr>
                                        <th>Subject Code</th>
                                        <th>Subject Name</th>
                                        <th>Units</th>
                                        <th>Schedule</th>
                                        <th>Room</th>
                                        <th>Instructor</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="enlistedSubjectsTable">
                                    <!-- Subjects will be populated here -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="payment-summary">
                            <div class="summary-row">
                                <span class="summary-label">Total Units Enlisted:</span>
                                <span class="summary-value">18 units</span>
                            </div>
                            <div class="summary-row">
                                <span class="summary-label">Laboratory Units:</span>
                                <span class="summary-value">3 units</span>
                            </div>
                            <div class="summary-row">
                                <span class="summary-label">Lecture Units:</span>
                                <span class="summary-value">15 units</span>
                            </div>
                            <div class="summary-row summary-total">
                                <span>Enlistment Status:</span>
                                <span style="color: #10b981;">Approved</span>
                            </div>
                        </div>
                        
                        <div class="form-actions profile">
                            <button type="button" class="btn btn-gray" onclick="closeStudentProfile()">Cancel</button>
                            <button type="button" class="btn btn-outline" onclick="printEnlistedSubjects()">
                                <i class="fas fa-print"></i> Print List
                            </button>
                        </div>
                    </div>

                    <!-- Grades Section -->
                    <div class="profile-section" id="grades-section">
                        <div class="section-title-modal">
                            <i class="fas fa-chart-line"></i> Grades
                        </div>
                        
                        <!-- Academic Year Selector -->
                        <div class="academic-year-selector" id="academicYearSelector">
                            <!-- Years will be populated dynamically -->
                        </div>

                        <!-- Semester Tabs -->
                        <div class="semester-tabs" id="semesterTabs">
                            <button class="semester-tab active" data-semester="1" onclick="showGradesSemester(1)">First Semester</button>
                            <button class="semester-tab" data-semester="2" onclick="showGradesSemester(2)">Second Semester</button>
                            <button class="semester-tab" data-semester="summer" onclick="showGradesSemester('summer')">Summer Term</button>
                        </div>

                        <!-- Grades Table -->
                        <div class="subject-table-container">
                            <table class="subject-table">
                                <thead>
                                    <tr>
                                        <th>Subject Code</th>
                                        <th>Subject Name</th>
                                        <th>Units</th>
                                        <th>Prelim</th>
                                        <th>Midterm</th>
                                        <th>Final</th>
                                        <th>Final Grade</th>
                                        <th>Remarks</th>
                                    </tr>
                                </thead>
                                <tbody id="gradesTableBody">
                                    <!-- Grades will be populated here -->
                                </tbody>
                            </table>
                        </div>

                        <!-- Grade Legend -->
                        <div class="grade-legend">
                            <div class="legend-item">
                                <div class="legend-color legend-excellent"></div>
                                <span>1.00 - 1.25 (Excellent)</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color legend-good"></div>
                                <span>1.50 - 1.75 (Good)</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color legend-fair"></div>
                                <span>2.00 - 2.25 (Fair)</span>
                            </div>
                            <div class="legend-item">
                                <div class="legend-color legend-poor"></div>
                                <span>2.50 - 5.00 (Poor)</span>
                            </div>
                        </div>
                        
                        <div class="form-actions profile">
                            <button type="button" class="btn btn-gray" onclick="closeStudentProfile()">Cancel</button>
                            <button type="button" class="btn btn-outline" onclick="printGrades()">
                                <i class="fas fa-print"></i> Print Grades
                            </button>
                            <button type="button" class="btn btn-primary" onclick="downloadGradesPDF()">
                                <i class="fas fa-download"></i> Download PDF
                            </button>
                        </div>
                    </div>

                    <!-- Class Schedule Section -->
                    <div class="profile-section" id="schedule-section">
                        <div class="section-title-modal">
                            <i class="fas fa-calendar-alt"></i> Class Schedule
                        </div>
                        
                        <div class="info-card" style="margin-bottom: 20px;">
                            <div class="label">Current Schedule</div>
                            <div class="value">1st Semester AY 2024-2025</div>
                        </div>
                        
                        <div class="schedule-table-container">
                            <table class="schedule-table">
                                <thead>
                                    <tr>
                                        <th>Time</th>
                                        <th>Monday</th>
                                        <th>Tuesday</th>
                                        <th>Wednesday</th>
                                        <th>Thursday</th>
                                        <th>Friday</th>
                                        <th>Saturday</th>
                                    </tr>
                                </thead>
                                <tbody id="scheduleTableBody">
                                    <!-- Schedule will be populated here -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="alert-box info" style="margin-top: 20px;">
                            <div class="alert-icon">
                                <i class="fas fa-info-circle"></i>
                            </div>
                            <div class="alert-content">
                                <div class="alert-title">Schedule Information</div>
                                <div>Class schedules are subject to change. Please check announcements regularly.</div>
                            </div>
                        </div>
                        
                        <div class="form-actions profile">
                            <button type="button" class="btn btn-gray" onclick="closeStudentProfile()">Cancel</button>
                            <button type="button" class="btn btn-outline" onclick="printSchedule()">
                                <i class="fas fa-print"></i> Print Schedule
                            </button>
                            <button type="button" class="btn btn-primary" onclick="downloadSchedulePDF()">
                                <i class="fas fa-download"></i> Download Schedule
                            </button>
                        </div>
                    </div>

                    <!-- Attendance Section -->
                    <div class="profile-section" id="attendance-section-profile">
                        <div class="section-title-modal">
                            <i class="fas fa-user-check"></i> Attendance Summary
                        </div>
                        
                        <!-- Attendance Statistics -->
                        <div class="attendance-stats">
                            <div class="stat-card">
                                <div class="label">Total Classes</div>
                                <div class="stat-value">128</div>
                            </div>
                            <div class="stat-card">
                                <div class="label">Present</div>
                                <div class="stat-value stat-present">118</div>
                                <div class="label">(92.2%)</div>
                            </div>
                            <div class="stat-card">
                                <div class="label">Absent</div>
                                <div class="stat-value stat-absent">8</div>
                                <div class="label">(6.2%)</div>
                            </div>
                            <div class="stat-card">
                                <div class="label">Late</div>
                                <div class="stat-value stat-late">2</div>
                                <div class="label">(1.6%)</div>
                            </div>
                        </div>

                        <!-- Subject-wise Attendance -->
                        <div class="section-title-modal" style="margin-top: 30px;">
                            <i class="fas fa-book"></i> Subject-wise Attendance
                        </div>
                        
                        <div class="subject-table-container">
                            <table class="subject-table">
                                <thead>
                                    <tr>
                                        <th>Subject</th>
                                        <th>Total Classes</th>
                                        <th>Present</th>
                                        <th>Absent</th>
                                        <th>Late</th>
                                        <th>Attendance %</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody id="subjectAttendanceTable">
                                    <!-- Attendance data will be populated here -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="form-actions profile">
                            <button type="button" class="btn btn-gray" onclick="closeStudentProfile()">Cancel</button>
                            <button type="button" class="btn btn-outline" onclick="printAttendanceSummary()">
                                <i class="fas fa-print"></i> Print Summary
                            </button>
                            <button type="button" class="btn btn-primary" onclick="downloadAttendanceReport()">
                                <i class="fas fa-download"></i> Download Report
                            </button>
                        </div>
                    </div>

                    <!-- Overall Result Section -->
                    <div class="profile-section" id="overall-section">
                        <div class="section-title-modal">
                            <i class="fas fa-chart-bar"></i> Overall Academic Result
                        </div>
                        
                        <!-- Overall Statistics -->
                        <div class="overall-stats">
                            <div class="stat-box">
                                <div class="stat-label">Current GPA</div>
                                <div class="stat-value">3.85</div>
                                <div class="stat-label">Cumulative</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-label">Total Units</div>
                                <div class="stat-value">105</div>
                                <div class="stat-label">Completed</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-label">Remaining Units</div>
                                <div class="stat-value">45</div>
                                <div class="stat-label">To Graduate</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-label">Academic Standing</div>
                                <div class="stat-value">Good</div>
                                <div class="stat-label">Status</div>
                            </div>
                        </div>
                        
                        <!-- Progress Chart -->
                        <div style="margin: 30px 0;">
                            <h4 style="margin-bottom: 15px;">Progress Towards Graduation</h4>
                            <div style="background: #f3f4f6; height: 20px; border-radius: 10px; overflow: hidden;">
                                <div style="background: linear-gradient(90deg, #10b981, #3b82f6); width: 70%; height: 100%; border-radius: 10px;"></div>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                                <span style="font-size: 0.85rem; color: var(--gray);">0%</span>
                                <span style="font-size: 0.85rem; color: var(--gray);">70% Complete</span>
                                <span style="font-size: 0.85rem; color: var(--gray);">100%</span>
                            </div>
                        </div>
                        
                        <!-- Semester-wise Performance -->
                        <div style="margin: 30px 0;">
                            <h4 style="margin-bottom: 15px;">Semester-wise Performance</h4>
                            <div class="subject-table-container">
                                <table class="subject-table">
                                    <thead>
                                        <tr>
                                            <th>Academic Year</th>
                                            <th>Semester</th>
                                            <th>GPA</th>
                                            <th>Units</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody id="semesterPerformanceTable">
                                        <!-- Performance data will be populated here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div class="form-actions profile">
                            <button type="button" class="btn btn-gray" onclick="closeStudentProfile()">Cancel</button>
                            <button type="button" class="btn btn-primary" onclick="downloadOverallReport()">
                                <i class="fas fa-download"></i> Download Overall Report
                            </button>
                        </div>
                    </div>

                    <!-- Exam Permit Section -->
                    <div class="profile-section" id="exam-permit-section">
                        <div class="section-title-modal">
                            <i class="fas fa-file-alt"></i> Exam Permit
                        </div>
                        
                        <div class="exam-permit-card">
                            <div class="permit-header">
                                <div class="permit-title">LEARNGATE UNIVERSITY</div>
                                <div class="permit-university">College of Computer Studies</div>
                                <div>MIDTERM EXAMINATION PERMIT</div>
                                <div class="permit-validity">Valid for: November 15-30, 2024</div>
                            </div>
                            
                            <div class="permit-details">
                                <div class="detail-row">
                                    <span class="detail-label">Student Name:</span>
                                    <span class="detail-value">JUAN DELA CRUZ</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Student ID:</span>
                                    <span class="detail-value">2023-001234</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Program:</span>
                                    <span class="detail-value">BSIT - Bachelor of Science in Information Technology</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Year & Section:</span>
                                    <span class="detail-value">3rd Year - BSIT-3A</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Semester:</span>
                                    <span class="detail-value">1st Semester AY 2024-2025</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Issued Date:</span>
                                    <span class="detail-value">November 10, 2024</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Valid Until:</span>
                                    <span class="detail-value">November 30, 2024</span>
                                </div>
                            </div>
                            
                            <div class="permit-qr">
                                <div class="qr-placeholder">
                                    <i class="fas fa-qrcode" style="font-size: 3rem; color: #6b7280;"></i>
                                </div>
                                <div style="font-size: 0.85rem; color: var(--gray);">
                                    Scan this QR code for verification
                                </div>
                            </div>
                            
                            <div style="text-align: center; margin-top: 20px;">
                                <div style="display: flex; justify-content: space-around;">
                                    <div>
                                        <div style="font-weight: 600; margin-bottom: 30px;">_______________________</div>
                                        <div>Registrar's Signature</div>
                                    </div>
                                    <div>
                                        <div style="font-weight: 600; margin-bottom: 30px;">_______________________</div>
                                        <div>Student's Signature</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="alert-box warning">
                            <div class="alert-icon">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                            <div class="alert-content">
                                <div class="alert-title">Important Notice</div>
                                <div>This exam permit must be presented at the examination room. Students without a valid permit will not be allowed to take the exam.</div>
                            </div>
                        </div>
                        
                        <div class="form-actions profile">
                            <button type="button" class="btn btn-gray" onclick="closeStudentProfile()">Cancel</button>
                            <button type="button" class="btn btn-outline" onclick="printExamPermit()">
                                <i class="fas fa-print"></i> Print Permit
                            </button>
                            <button type="button" class="btn btn-primary" onclick="downloadExamPermit()">
                                <i class="fas fa-download"></i> Download Permit
                            </button>
                        </div>
                    </div>

                    <!-- Documents Section -->
                    <div class="profile-section" id="documents-section">
                        <div class="section-title-modal">
                            <i class="fas fa-folder"></i> Documents
                        </div>
                        
                        <div class="alert-box info">
                            <div class="alert-icon">
                                <i class="fas fa-info-circle"></i>
                            </div>
                            <div class="alert-content">
                                <div class="alert-title">Document Access</div>
                                <div>All your academic and administrative documents are available for download here.</div>
                            </div>
                        </div>
                        
                        <div class="documents-grid" id="profileDocumentsGrid">
                            <!-- Documents will be populated here -->
                        </div>
                        
                        <div class="form-actions profile">
                            <button type="button" class="btn btn-gray" onclick="closeStudentProfile()">Cancel</button>
                            <button type="button" class="btn btn-primary" onclick="refreshProfileDocuments()">
                                <i class="fas fa-sync-alt"></i> Refresh Documents
                            </button>
                        </div>
                    </div>

                    <!-- Exam Schedule Section -->
                    <div class="profile-section" id="exam-schedule-section">
                        <div class="section-title-modal">
                            <i class="fas fa-calendar-times"></i> Examination Schedule
                        </div>
                        
                        <div class="info-card" style="margin-bottom: 20px;">
                            <div class="label">Current Examination Period</div>
                            <div class="value">Midterm Examinations - November 15-30, 2024</div>
                        </div>
                        
                        <div id="examScheduleList">
                            <!-- Exam schedule will be populated here -->
                        </div>
                        
                        <div class="alert-box warning" style="margin-top: 20px;">
                            <div class="alert-icon">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                            <div class="alert-content">
                                <div class="alert-title">Examination Rules</div>
                                <div>
                                    <ol style="margin: 10px 0 0 20px; font-size: 0.9rem;">
                                        <li>Bring your student ID and exam permit</li>
                                        <li>Arrive 15 minutes before the exam starts</li>
                                        <li>No electronic devices allowed (except calculators if permitted)</li>
                                        <li>Strictly no cheating - violations will result in automatic failure</li>
                                    </ol>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-actions profile">
                            <button type="button" class="btn btn-gray" onclick="closeStudentProfile()">Cancel</button>
                            <button type="button" class="btn btn-outline" onclick="printExamSchedule()">
                                <i class="fas fa-print"></i> Print Schedule
                            </button>
                            <button type="button" class="btn btn-primary" onclick="downloadExamSchedule()">
                                <i class="fas fa-download"></i> Download Schedule
                            </button>
                        </div>
                    </div>

                    <!-- Apply Deferment Section -->
                    <div class="profile-section" id="deferment-section">
                        <div class="section-title-modal">
                            <i class="fas fa-clock"></i> Apply for Deferment
                        </div>
                        
                        <div class="deferment-form">
                            <div class="alert-box info">
                                <div class="alert-icon">
                                    <i class="fas fa-info-circle"></i>
                                </div>
                                <div class="alert-content">
                                    <div class="alert-title">Deferment Information</div>
                                    <div>Deferment allows you to postpone your studies for a semester. This request requires approval from the Academic Dean.</div>
                                </div>
                            </div>
                            
                            <form id="defermentForm">
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label class="form-label">Student Name *</label>
                                        <input type="text" class="form-control" value="Juan Dela Cruz" readonly>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Student ID *</label>
                                        <input type="text" class="form-control" value="2023-001234" readonly>
                                    </div>
                                </div>
                                
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label class="form-label">Current Semester *</label>
                                        <select class="form-select" id="defermentSemester" required>
                                            <option value="">Select Semester</option>
                                            <option value="1st Semester AY 2024-2025">1st Semester AY 2024-2025</option>
                                            <option value="2nd Semester AY 2024-2025">2nd Semester AY 2024-2025</option>
                                            <option value="Summer AY 2024-2025">Summer AY 2024-2025</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Deferment Period *</label>
                                        <select class="form-select" id="defermentPeriod" required>
                                            <option value="">Select Period</option>
                                            <option value="1 Semester">1 Semester</option>
                                            <option value="2 Semesters">2 Semesters</option>
                                            <option value="1 Academic Year">1 Academic Year</option>
                                            <option value="Indefinite">Indefinite</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Reason for Deferment *</label>
                                    <div class="reason-options">
                                        <div class="reason-option">
                                            <div class="form-check">
                                                <input type="radio" class="form-check-input" name="defermentReason" id="reasonMedical" value="Medical" required>
                                                <label class="form-check-label" for="reasonMedical">Medical Reasons</label>
                                            </div>
                                        </div>
                                        <div class="reason-option">
                                            <div class="form-check">
                                                <input type="radio" class="form-check-input" name="defermentReason" id="reasonFinancial" value="Financial" required>
                                                <label class="form-check-label" for="reasonFinancial">Financial Difficulties</label>
                                            </div>
                                        </div>
                                        <div class="reason-option">
                                            <div class="form-check">
                                                <input type="radio" class="form-check-input" name="defermentReason" id="reasonPersonal" value="Personal" required>
                                                <label class="form-check-label" for="reasonPersonal">Personal/Family Matters</label>
                                            </div>
                                        </div>
                                        <div class="reason-option">
                                            <div class="form-check">
                                                <input type="radio" class="form-check-input" name="defermentReason" id="reasonWork" value="Work" required>
                                                <label class="form-check-label" for="reasonWork">Work Commitments</label>
                                            </div>
                                        </div>
                                        <div class="reason-option">
                                            <div class="form-check">
                                                <input type="radio" class="form-check-input" name="defermentReason" id="reasonOther" value="Other" required>
                                                <label class="form-check-label" for="reasonOther">Other (Specify below)</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Explanation *</label>
                                    <textarea class="form-control" id="defermentExplanation" rows="4" required placeholder="Please provide detailed explanation for your deferment request..."></textarea>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Supporting Documents</label>
                                    <input type="file" class="form-control" id="supportingDocs" multiple accept=".pdf,.jpg,.jpeg,.png,.doc,.docx">
                                    <div class="form-hint">You may upload medical certificates, financial documents, or other supporting files (Max 10MB total)</div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Expected Return Date</label>
                                    <input type="date" class="form-control" id="expectedReturnDate">
                                </div>
                                
                                <div class="alert-box warning">
                                    <div class="alert-icon">
                                        <i class="fas fa-exclamation-triangle"></i>
                                    </div>
                                    <div class="alert-content">
                                        <div class="alert-title">Important Notes</div>
                                        <div>
                                            <ul style="margin: 10px 0 0 20px; font-size: 0.9rem;">
                                                <li>Deferment approval may take 7-14 working days</li>
                                                <li>You will need to pay deferment processing fee if approved</li>
                                                <li>All enrolled subjects will be dropped upon approval</li>
                                                <li>You must re-enlist when you return from deferment</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="form-actions profile">
                                    <button type="button" class="btn btn-gray" onclick="closeStudentProfile()">Cancel</button>
                                    <button type="submit" class="btn btn-primary">Submit Deferment Request</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Course Enlistment Modal -->
    <div id="courseEnlistmentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-clipboard-list"></i> Course Enlistment</h2>
                <button class="modal-close" onclick="closeCourseEnlistment()">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Stepper -->
                <div class="stepper">
                    <div class="step active" id="enlistmentStep1">
                        <div class="step-icon">1</div>
                        <div class="step-label">Student Details</div>
                    </div>
                    <div class="step" id="enlistmentStep2">
                        <div class="step-icon">2</div>
                        <div class="step-label">Subject Selection</div>
                    </div>
                    <div class="step" id="enlistmentStep3">
                        <div class="step-icon">3</div>
                        <div class="step-label">Enlistment Status</div>
                    </div>
                </div>

                <!-- Step 1: Student Details -->
                <div class="step-content active" id="enlistmentStep1-content">
                    <div class="section-title-modal">
                        <i class="fas fa-user-graduate"></i> Student & Registration Details
                    </div>
                    
                    <div class="info-card" style="margin-bottom: 20px;">
                        <div class="label">Current Academic Status</div>
                        <div class="value">Regular Student - Good Standing</div>
                    </div>
                    
                    <form id="enlistmentDetailsForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Student ID *</label>
                                <input type="text" class="form-control" value="2023-001234" readonly>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Full Name *</label>
                                <input type="text" class="form-control" value="Juan Dela Cruz" readonly>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Program *</label>
                                <input type="text" class="form-control" value="BSIT - Bachelor of Science in Information Technology" readonly>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Year Level *</label>
                                <input type="text" class="form-control" value="3rd Year" readonly>
                            </div>
                        </div>
                        
                        <div class="section-title-modal" style="margin-top: 30px;">
                            <i class="fas fa-calendar-alt"></i> Registration Details
                        </div>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Current Semester *</label>
                                <select class="form-select" id="semester" required>
                                    <option value="">Select Semester</option>
                                    <option value="1st Semester AY 2024-2025" selected>1st Semester AY 2024-2025</option>
                                    <option value="2nd Semester AY 2024-2025">2nd Semester AY 2024-2025</option>
                                    <option value="Summer AY 2024-2025">Summer AY 2024-2025</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Campus *</label>
                                <select class="form-select" id="campus" required>
                                    <option value="">Select Campus</option>
                                    <option value="Main Campus" selected>Main Campus</option>
                                    <option value="North Campus">North Campus</option>
                                    <option value="South Campus">South Campus</option>
                                    <option value="East Campus">East Campus</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Learning Modality *</label>
                                <select class="form-select" id="modality" required>
                                    <option value="">Select Modality</option>
                                    <option value="Face-to-Face" selected>Face-to-Face</option>
                                    <option value="Online">Online</option>
                                    <option value="Hybrid">Hybrid</option>
                                    <option value="Blended">Blended Learning</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Session *</label>
                                <select class="form-select" id="session" required>
                                    <option value="">Select Session</option>
                                    <option value="Regular Session" selected>Regular Session</option>
                                    <option value="Weekend Session">Weekend Session</option>
                                    <option value="Evening Session">Evening Session</option>
                                    <option value="Executive Session">Executive Session</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">I wish to register for *</label>
                                <select class="form-select" id="registrationType" required>
                                    <option value="">Select Registration Type</option>
                                    <option value="Regular Load" selected>Regular Load (15-21 units)</option>
                                    <option value="Overload">Overload (22-24 units)</option>
                                    <option value="Underload">Underload (12-14 units)</option>
                                    <option value="Thesis Only">Thesis/Dissertation Only</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Time Slot Preference *</label>
                                <div style="margin-top: 10px;">
                                    <div class="form-check">
                                        <input type="radio" class="form-check-input" name="timeSlot" id="timeMorning" value="Morning" checked required>
                                        <label class="form-check-label" for="timeMorning">Morning Schedule (7:00 AM - 12:00 PM)</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="radio" class="form-check-input" name="timeSlot" id="timeAfternoon" value="Afternoon" required>
                                        <label class="form-check-label" for="timeAfternoon">Afternoon Schedule (1:00 PM - 6:00 PM)</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="radio" class="form-check-input" name="timeSlot" id="timeEvening" value="Evening" required>
                                        <label class="form-check-label" for="timeEvening">Evening Schedule (6:00 PM - 9:00 PM)</label>
                                    </div>
                                    <div class="form-check">
                                        <input type="radio" class="form-check-input" name="timeSlot" id="timeMixed" value="Mixed" required>
                                        <label class="form-check-label" for="timeMixed">Mixed Schedule (Any Time)</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" class="btn btn-gray" onclick="closeCourseEnlistment()">Cancel</button>
                            <button type="submit" class="btn btn-primary">Next: Select Subjects</button>
                        </div>
                    </form>
                </div>

                <!-- Step 2: Subject Selection -->
                <div class="step-content" id="enlistmentStep2-content">
                    <div class="section-title-modal">
                        <i class="fas fa-book"></i> Subject Selection
                    </div>
                    
                    <div class="info-card" style="margin-bottom: 20px; background: #fef3c7; border-left-color: #f59e0b;">
                        <div class="label">Important Notes:</div>
                        <div class="value">
                            <ol style="margin: 10px 0 0 20px; font-size: 0.9rem;">
                                <li><strong style="color: #dc2626;">Red highlighted subjects</strong> indicate that prerequisite is not fulfilled.</li>
                                <li><strong style="color: #059669;">Green highlighted subjects</strong> are higher level subjects with respect to curriculum.</li>
                                <li>Maximum units allowed: 21 units for regular load</li>
                                <li>Minimum units required: 12 units for regular students</li>
                            </ol>
                        </div>
                    </div>
                    
                    <div class="subject-table-container">
                        <table class="subject-table">
                            <thead>
                                <tr>
                                    <th style="width: 40px;">Select</th>
                                    <th>Subject Code</th>
                                    <th>Subject Name</th>
                                    <th>Units</th>
                                    <th>Schedule</th>
                                    <th>Room</th>
                                    <th>Instructor</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="subjectSelectionTable">
                                <!-- Subjects will be populated here -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="payment-summary">
                        <div class="summary-row">
                            <span class="summary-label">Total Units Selected:</span>
                            <span class="summary-value" id="totalUnitsSelected">0 units</span>
                        </div>
                        <div class="summary-row">
                            <span class="summary-label">Maximum Allowed Units:</span>
                            <span class="summary-value">21 units</span>
                        </div>
                        <div class="summary-row">
                            <span class="summary-label">Minimum Required Units:</span>
                            <span class="summary-value">12 units</span>
                        </div>
                        <div class="summary-row summary-total">
                            <span>Enlistment Status:</span>
                            <span id="enlistmentStatusText" style="color: #dc2626;">Select at least 12 units</span>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-gray" onclick="previousEnlistmentStep()">
                            <i class="fas fa-arrow-left"></i> Previous
                        </button>
                        <button type="button" class="btn btn-primary" onclick="nextToEnlistmentStep3()" id="proceedToEnlistmentStep3" disabled>
                            Next: Enlistment Status <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <!-- Step 3: Enlistment Status -->
                <div class="step-content" id="enlistmentStep3-content">
                    <div class="section-title-modal">
                        <i class="fas fa-clipboard-check"></i> Enlistment Status
                    </div>
                    
                    <!-- Pending Status (Initial) -->
                    <div class="status-card pending" id="pendingEnlistmentStatus">
                        <div class="status-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="status-title">Enlistment Under Review</div>
                        <div class="status-message">
                            Your course enlistment request has been submitted successfully and is currently under review by the Registrar's Office.
                            <br><br>
                            <strong>Reference Number:</strong> ENL-2024-001234
                            <br>
                            <strong>Submitted On:</strong> October 28, 2024 10:30 AM
                            <br>
                            <strong>Expected Approval:</strong> Within 24-48 hours
                        </div>
                        <div class="action-buttons">
                            <button class="btn btn-outline" onclick="downloadORF()">
                                <i class="fas fa-download"></i> Download ORF
                            </button>
                            <button class="btn btn-outline" onclick="openMyPayment()">
                                <i class="fas fa-file-invoice-dollar"></i> My Payments
                            </button>
                        </div>
                    </div>
                    
                    <!-- Approved Status -->
                    <div class="status-card approved" id="approvedEnlistmentStatus" style="display: none;">
                        <div class="status-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="status-title">Enlistment Approved!</div>
                        <div class="status-message">
                            Your course enlistment has been approved by the Registrar's Office.
                            <br><br>
                            <strong>Approval Date:</strong> October 29, 2024 9:15 AM
                            <br>
                            <strong>Approved By:</strong> Registrar's Office
                            <br>
                            <strong>Valid Until:</strong> November 15, 2024
                            <br>
                            <strong>Total Units Approved:</strong> 18 units
                        </div>
                        <div class="action-buttons">
                            <button class="btn btn-primary" onclick="downloadOfficialForm()">
                                <i class="fas fa-file-pdf"></i> Download Official Registration Form
                            </button>
                            <button class="btn btn-success" onclick="openMyPayment()">
                                <i class="fas fa-credit-card"></i> Proceed to Payment
                            </button>
                        </div>
                    </div>
                    
                    <!-- Rejected Status -->
                    <div class="status-card rejected" id="rejectedEnlistmentStatus" style="display: none;">
                        <div class="status-icon">
                            <i class="fas fa-times-circle"></i>
                        </div>
                        <div class="status-title">Enlistment Requires Revision</div>
                        <div class="status-message">
                            Your course enlistment request requires revision for the following reasons:
                            <br><br>
                            <strong>Reason:</strong> Prerequisite requirements not met for CS 302
                            <br>
                            <strong>Reviewed On:</strong> October 29, 2024 10:45 AM
                            <br>
                            <strong>Reviewer:</strong> Academic Coordinator
                            <br>
                            <strong>Action Required:</strong> Resubmit with corrected subjects
                        </div>
                        <div class="action-buttons">
                            <button class="btn btn-primary" onclick="resubmitEnlistment()">
                                <i class="fas fa-redo"></i> Resubmit Enlistment
                            </button>
                            <button class="btn btn-outline" onclick="contactAdvisor()">
                                <i class="fas fa-user-graduate"></i> Contact Academic Advisor
                            </button>
                        </div>
                    </div>
                    
                    <!-- Subject Summary -->
                    <div style="margin-top: 30px;">
                        <h4 style="margin-bottom: 15px;">Selected Subjects Summary</h4>
                        <div class="subject-table-container">
                            <table class="subject-table">
                                <thead>
                                    <tr>
                                        <th>Subject Code</th>
                                        <th>Subject Name</th>
                                        <th>Units</th>
                                        <th>Schedule</th>
                                        <th>Room</th>
                                        <th>Instructor</th>
                                    </tr>
                                </thead>
                                <tbody id="enlistedSummaryTable">
                                    <!-- Summary will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-gray" onclick="previousEnlistmentStep()">
                            <i class="fas fa-arrow-left"></i> Previous
                        </button>
                        <button type="button" class="btn btn-primary" onclick="submitEnlistment()" id="submitEnlistmentBtn">
                            <i class="fas fa-paper-plane"></i> Submit Enlistment
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- My Payment Modal -->
    <div id="myPaymentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-file-invoice-dollar"></i> My Payment</h2>
                <button class="modal-close" onclick="closeMyPayment()">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Stepper -->
                <div class="stepper">
                    <div class="step active" id="paymentStep1">
                        <div class="step-icon">1</div>
                        <div class="step-label">Student Details</div>
                    </div>
                    <div class="step" id="paymentStep2">
                        <div class="step-icon">2</div>
                        <div class="step-label">Payment Request</div>
                    </div>
                    <div class="step" id="paymentStep3">
                        <div class="step-icon">3</div>
                        <div class="step-label">Registration Status</div>
                    </div>
                </div>

                <!-- Step 1: Student Details -->
                <div class="step-content active" id="paymentStep1-content">
                    <div class="section-title-modal">
                        <i class="fas fa-user-graduate"></i> Student & Registration Details
                    </div>
                    
                    <!-- Important Alert Box -->
                    <div class="alert-box warning" id="profileAlert">
                        <div class="alert-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="alert-content">
                            <div class="alert-title">Important Notice</div>
                            <div>Kindly complete your student profile one time to proceed for down payment. Please verify all your details before proceeding.</div>
                        </div>
                    </div>
                    
                    <div class="alert-box danger" id="balanceAlert" style="display: none;">
                        <div class="alert-icon">
                            <i class="fas fa-exclamation-circle"></i>
                        </div>
                        <div class="alert-content">
                            <div class="alert-title">Outstanding Balance Detected</div>
                            <div>You have an outstanding balance of <strong>5,000.00</strong>. Please clear it first or you may apply for a promissory note.</div>
                            <div style="margin-top: 10px;">
                                <button class="btn btn-sm btn-outline" onclick="applyPromissoryNote()">
                                    <i class="fas fa-file-signature"></i> Apply for Promissory Note
                                </button>
                                <button class="btn btn-sm btn-primary" onclick="clearOutstandingBalance()" style="margin-left: 10px;">
                                    <i class="fas fa-money-check"></i> Clear Balance Now
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="info-card" style="margin-bottom: 20px;">
                        <div class="label">Current Academic Status</div>
                        <div class="value">Regular Student - Good Standing</div>
                    </div>
                    
                    <form id="paymentDetailsForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Student ID *</label>
                                <input type="text" class="form-control" value="2023-001234" readonly>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Full Name *</label>
                                <input type="text" class="form-control" value="Juan Dela Cruz" readonly>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Program *</label>
                                <input type="text" class="form-control" value="BSIT - Bachelor of Science in Information Technology" readonly>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Year Level *</label>
                                <input type="text" class="form-control" value="3rd Year" readonly>
                            </div>
                        </div>
                        
                        <div class="section-title-modal" style="margin-top: 30px;">
                            <i class="fas fa-calendar-alt"></i> Registration Details
                        </div>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Current Semester *</label>
                                <select class="form-select" id="paymentSemester" required>
                                    <option value="">Select Semester</option>
                                    <option value="1st Semester AY 2024-2025" selected>1st Semester AY 2024-2025</option>
                                    <option value="2nd Semester AY 2024-2025">2nd Semester AY 2024-2025</option>
                                    <option value="Summer AY 2024-2025">Summer AY 2024-2025</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Campus *</label>
                                <select class="form-select" id="paymentCampus" required>
                                    <option value="">Select Campus</option>
                                    <option value="Main Campus" selected>Main Campus</option>
                                    <option value="North Campus">North Campus</option>
                                    <option value="South Campus">South Campus</option>
                                    <option value="East Campus">East Campus</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">College *</label>
                                <select class="form-select" id="paymentCollege" required>
                                    <option value="">Select College</option>
                                    <option value="College of Computer Studies" selected>College of Computer Studies</option>
                                    <option value="College of Engineering">College of Engineering</option>
                                    <option value="College of Business Administration">College of Business Administration</option>
                                    <option value="College of Education">College of Education</option>
                                    <option value="College of Arts and Sciences">College of Arts and Sciences</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Session *</label>
                                <select class="form-select" id="paymentSession" required>
                                    <option value="">Select Session</option>
                                    <option value="Regular Session" selected>Regular Session</option>
                                    <option value="Weekend Session">Weekend Session</option>
                                    <option value="Evening Session">Evening Session</option>
                                    <option value="Executive Session">Executive Session</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Balance Information -->
                        <div class="section-title-modal" style="margin-top: 30px;">
                            <i class="fas fa-money-check-alt"></i> Financial Information
                        </div>
                        
                        <div class="payment-summary">
                            <div class="summary-row">
                                <span class="summary-label">Total Tuition Fee:</span>
                                <span class="summary-value">45,000.00</span>
                            </div>
                            <div class="summary-row">
                                <span class="summary-label">Miscellaneous Fees:</span>
                                <span class="summary-value">5,000.00</span>
                            </div>
                            <div class="summary-row">
                                <span class="summary-label">Laboratory Fees:</span>
                                <span class="summary-value">3,000.00</span>
                            </div>
                            <div class="summary-row">
                                <span class="summary-label">Previous Balance:</span>
                                <span class="summary-value" style="color: #ef4444;" id="previousBalance">0.00</span>
                            </div>
                            <div class="summary-row summary-total">
                                <span>Total Amount Due:</span>
                                <span id="totalAmountDue">53,000.00</span>
                            </div>
                            <div class="summary-row">
                                <span class="summary-label">Amount Paid:</span>
                                <span class="summary-value" style="color: #10b981;">0.00</span>
                            </div>
                            <div class="summary-row">
                                <span class="summary-label">Outstanding Balance:</span>
                                <span class="summary-value" style="color: #ef4444; font-weight: bold;" id="outstandingBalance">53,000.00</span>
                            </div>
                        </div>
                        
                        <div class="alert-box info">
                            <div class="alert-icon">
                                <i class="fas fa-info-circle"></i>
                            </div>
                            <div class="alert-content">
                                <div class="alert-title">Verification Required</div>
                                <div>Please verify all the details above before proceeding to the next step. Ensure that all information is correct.</div>
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" class="btn btn-gray" onclick="closeMyPayment()">Cancel</button>
                            <button type="submit" class="btn btn-primary">Next: Payment Request</button>
                        </div>
                    </form>
                </div>

                <!-- Step 2: Payment Request -->
                <div class="step-content" id="paymentStep2-content">
                    <div class="section-title-modal">
                        <i class="fas fa-credit-card"></i> Payment Request
                    </div>
                    
                    <div class="alert-box info">
                        <div class="alert-icon">
                            <i class="fas fa-info-circle"></i>
                        </div>
                        <div class="alert-content">
                            <div class="alert-title">Payment Instructions</div>
                            <div>Click on the PAY button to submit your payment request. For cash payments, you need to visit the university counter to pay the amount in cash.</div>
                        </div>
                    </div>
                    
                    <!-- Payment Methods -->
                    <div style="margin: 20px 0;">
                        <h4 style="margin-bottom: 15px;">Select Payment Method</h4>
                        <div class="payment-options">
                            <div class="payment-option selected" onclick="selectPaymentMethod('online')">
                                <div class="payment-icon">
                                    <i class="fas fa-globe"></i>
                                </div>
                                <div class="payment-name">Online Payment</div>
                                <div class="payment-description">Credit/Debit Card, E-wallet, Bank Transfer</div>
                            </div>
                            <div class="payment-option" onclick="selectPaymentMethod('cash')">
                                <div class="payment-icon">
                                    <i class="fas fa-money-bill-wave"></i>
                                </div>
                                <div class="payment-name">Cash Payment</div>
                                <div class="payment-description">Pay at University Counter</div>
                            </div>
                            <div class="payment-option" onclick="selectPaymentMethod('installment')">
                                <div class="payment-icon">
                                    <i class="fas fa-calendar-alt"></i>
                                </div>
                                <div class="payment-name">Installment Plan</div>
                                <div class="payment-description">Pay in multiple installments</div>
                            </div>
                            <div class="payment-option" onclick="selectPaymentMethod('bank')">
                                <div class="payment-icon">
                                    <i class="fas fa-university"></i>
                                </div>
                                <div class="payment-name">Bank Deposit</div>
                                <div class="payment-description">Deposit to university bank account</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Payment Amount -->
                    <div class="payment-summary">
                        <div class="summary-row">
                            <span class="summary-label">Payment Method:</span>
                            <span class="summary-value" id="selectedPaymentMethod">Online Payment</span>
                        </div>
                        <div class="summary-row">
                            <span class="summary-label">Total Amount Due:</span>
                            <span class="summary-value">53,000.00</span>
                        </div>
                        <div class="form-group" style="margin-top: 15px;">
                            <label class="form-label">Amount to Pay *</label>
                            <input type="number" class="form-control" id="paymentAmount" value="53000" min="1" max="53000" step="100" required>
                            <div class="form-hint">Enter the amount you wish to pay (minimum 100)</div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Payment Reference (Optional)</label>
                            <input type="text" class="form-control" id="paymentReference" placeholder="e.g., Bank Transaction ID, Receipt Number">
                        </div>
                    </div>
                    
                    <!-- Payment Instructions for Cash -->
                    <div class="alert-box warning" id="cashPaymentInstructions" style="display: none;">
                        <div class="alert-icon">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="alert-content">
                            <div class="alert-title">Cash Payment Instructions</div>
                            <div>
                                <p>For cash payments, please:</p>
                                <ol style="margin: 10px 0 0 20px;">
                                    <li>Visit the University Cashier's Office (Main Campus, Administration Building, Ground Floor)</li>
                                    <li>Bring your Student ID and this payment reference number</li>
                                    <li>Payment hours: Monday-Friday, 8:00 AM - 5:00 PM</li>
                                    <li>Keep your official receipt for verification</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Bank Details for Bank Deposit -->
                    <div class="alert-box info" id="bankDetails" style="display: none;">
                        <div class="alert-icon">
                            <i class="fas fa-university"></i>
                        </div>
                        <div class="alert-content">
                            <div class="alert-title">Bank Deposit Details</div>
                            <div>
                                <p><strong>Bank Name:</strong> Philippine National Bank</p>
                                <p><strong>Account Name:</strong> LearnGate University</p>
                                <p><strong>Account Number:</strong> 1234-5678-9012</p>
                                <p><strong>Branch:</strong> Main Branch, Manila</p>
                                <p>Please include your Student ID in the deposit slip remarks.</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Installment Options -->
                    <div class="alert-box info" id="installmentOptions" style="display: none;">
                        <div class="alert-icon">
                            <i class="fas fa-calendar-alt"></i>
                        </div>
                        <div class="alert-content">
                            <div class="alert-title">Installment Plan Options</div>
                            <div>
                                <div class="form-check">
                                    <input type="radio" class="form-check-input" name="installmentOption" id="installment2" value="2" checked>
                                    <label class="form-check-label" for="installment2">2 Installments (26,500 each)</label>
                                </div>
                                <div class="form-check">
                                    <input type="radio" class="form-check-input" name="installmentOption" id="installment3" value="3">
                                    <label class="form-check-label" for="installment3">3 Installments (17,667 each)</label>
                                </div>
                                <div class="form-check">
                                    <input type="radio" class="form-check-input" name="installmentOption" id="installment4" value="4">
                                    <label class="form-check-label" for="installment4">4 Installments (13,250 each)</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-gray" onclick="previousPaymentStep()">
                            <i class="fas fa-arrow-left"></i> Previous
                        </button>
                        <button type="button" class="btn btn-primary" onclick="submitPaymentRequest()">
                            <i class="fas fa-paper-plane"></i> Submit Payment Request
                        </button>
                    </div>
                </div>

                <!-- Step 3: Registration Status -->
                <div class="step-content" id="paymentStep3-content">
                    <div class="section-title-modal">
                        <i class="fas fa-clipboard-check"></i> Registration Status
                    </div>
                    
                    <!-- Payment Status -->
                    <div class="status-card pending" id="paymentPendingStatus">
                        <div class="status-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="status-title">Payment Request Submitted</div>
                        <div class="status-message">
                            Your payment request has been submitted successfully and is currently being processed.
                            <br><br>
                            <strong>Reference Number:</strong> PAY-2024-001234
                            <br>
                            <strong>Amount:</strong> 53,000.00
                            <br>
                            <strong>Payment Method:</strong> Online Payment
                            <br>
                            <strong>Submitted On:</strong> October 28, 2024 2:30 PM
                            <br>
                            <strong>Expected Confirmation:</strong> Within 24 hours
                        </div>
                        <div class="action-buttons">
                            <button class="btn btn-outline" onclick="downloadPaymentReceipt()">
                                <i class="fas fa-download"></i> Download Payment Request
                            </button>
                            <button class="btn btn-outline" onclick="viewPaymentHistory()">
                                <i class="fas fa-history"></i> View Payment History
                            </button>
                        </div>
                    </div>
                    
                    <!-- Payment Approved Status -->
                    <div class="status-card approved" id="paymentApprovedStatus" style="display: none;">
                        <div class="status-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="status-title">Payment Confirmed!</div>
                        <div class="status-message">
                            Your payment has been confirmed and your registration is now complete.
                            <br><br>
                            <strong>Confirmation Date:</strong> October 29, 2024 10:15 AM
                            <br>
                            <strong>Confirmed By:</strong> Finance Office
                            <br>
                            <strong>Transaction ID:</strong> TXN-2024-567890
                            <br>
                            <strong>Amount Paid:</strong> 53,000.00
                            <br>
                            <strong>Balance Due:</strong> 0.00
                        </div>
                        <div class="action-buttons">
                            <button class="btn btn-primary" onclick="downloadOfficialReceipt()">
                                <i class="fas fa-file-pdf"></i> Download Official Receipt
                            </button>
                            <button class="btn btn-success" onclick="downloadRegistrationForm()">
                                <i class="fas fa-certificate"></i> Download Registration Form
                            </button>
                        </div>
                    </div>
                    
                    <!-- Payment Rejected Status -->
                    <div class="status-card rejected" id="paymentRejectedStatus" style="display: none;">
                        <div class="status-icon">
                            <i class="fas fa-times-circle"></i>
                        </div>
                        <div class="status-title">Payment Requires Action</div>
                        <div class="status-message">
                            Your payment request requires attention for the following reasons:
                            <br><br>
                            <strong>Reason:</strong> Insufficient funds / Payment declined
                            <br>
                            <strong>Reviewed On:</strong> October 29, 2024 11:45 AM
                            <br>
                            <strong>Reviewer:</strong> Finance Department
                            <br>
                            <strong>Action Required:</strong> Please use a different payment method or contact the finance office
                        </div>
                        <div class="action-buttons">
                            <button class="btn btn-primary" onclick="resubmitPayment()">
                                <i class="fas fa-redo"></i> Resubmit Payment
                            </button>
                            <button class="btn btn-outline" onclick="contactFinanceOffice()">
                                <i class="fas fa-phone-alt"></i> Contact Finance Office
                            </button>
                        </div>
                    </div>
                    
                    <!-- Registration Status Overview -->
                    <div style="margin-top: 30px;">
                        <h4 style="margin-bottom: 15px;">Registration Status Overview</h4>
                        <div class="registration-status">
                            <div class="status-item completed" id="statusProfile">
                                <div class="status-icon-small">
                                    <i class="fas fa-user-check"></i>
                                </div>
                                <div class="status-item-title">Student Profile</div>
                                <div class="status-item-desc">Completed</div>
                            </div>
                            <div class="status-item completed" id="statusEnlistment">
                                <div class="status-icon-small">
                                    <i class="fas fa-clipboard-check"></i>
                                </div>
                                <div class="status-item-title">Course Enlistment</div>
                                <div class="status-item-desc">Approved</div>
                            </div>
                            <div class="status-item pending" id="statusPayment">
                                <div class="status-icon-small">
                                    <i class="fas fa-money-check-alt"></i>
                                </div>
                                <div class="status-item-title">Payment</div>
                                <div class="status-item-desc">Pending</div>
                            </div>
                            <div class="status-item not-started" id="statusRegistration">
                                <div class="status-icon-small">
                                    <i class="fas fa-certificate"></i>
                                </div>
                                <div class="status-item-title">Final Registration</div>
                                <div class="status-item-desc">Not Started</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-gray" onclick="previousPaymentStep()">
                            <i class="fas fa-arrow-left"></i> Previous
                        </button>
                        <button type="button" class="btn btn-primary" onclick="checkPaymentStatus()">
                            <i class="fas fa-sync-alt"></i> Check Status
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== FIREBASE CONFIGURATION ====================
        const firebaseConfig = {
            apiKey: "AIzaSyDLYGYFoyb0WZmQy5szNdXVQRi5DFjX2QM",
            authDomain: "learngate-portal.firebaseapp.com",
            projectId: "learngate-portal",
            storageBucket: "learngate-portal.firebasestorage.app",
            messagingSenderId: "59836663228",
            appId: "1:59836663228:web:20a19523bc8648481a97b9",
            measurementId: "G-0M7W3X92SX"
        };

        // Initialize Firebase
        let auth, db, firestore;
        
        try {
            if (!firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
                console.log(" Firebase initialized successfully");
            } else {
                firebase.app();
                console.log(" Firebase already initialized");
            }
            
            auth = firebase.auth();
            db = firebase.firestore();
            firestore = firebase.firestore();
            
            console.log(" Firebase services loaded");
            
        } catch (error) {
            console.error(" Firebase initialization error:", error);
        }

        // ==================== GLOBAL VARIABLES ====================
        let currentUser = null;
        let userData = {};
        let unsubscribeFunctions = [];
        let currentDate = new Date();
        let selectedDate = new Date();
        let calendarEvents = {};
        let calendarEventListener = null;
        
        // Academic Data
        let academicYears = [];
        let gradesData = {};
        let currentAcademicYear = '';
        let currentSemester = '1';

        // Student Data
        let studentProfile = {};
        let studentEnrollmentYear = 2021;
        let studentCourseYears = 4;

        // ==================== INITIALIZATION ====================
        document.addEventListener('DOMContentLoaded', function() {
            console.log(' Dashboard Initializing...');
            
            // Add click handler for logo to redirect to maindashboard.html
            const logoHome = document.getElementById('logo-home');
            if (logoHome) {
                logoHome.addEventListener('click', function(e) {
                    e.preventDefault();
                    window.location.href = 'maindashboard.html';
                });
            }
            
            updateDateTime();
            setInterval(updateDateTime, 1000);
            
            initializeCollapsibleSections();
            initializeCalendar();
            loadStudentData();
            
            checkAuthState();
        });

        // ==================== SUBJECT COMPLETION FUNCTIONS (UPDATED) ====================
        function openSubjectCompletion() {
            console.log('Opening Subject Completion (INC) modal');
            document.getElementById('subjectCompletionModal').style.display = 'block';
            loadSubjectCompletionData();
        }

        function closeSubjectCompletion() {
            document.getElementById('subjectCompletionModal').style.display = 'none';
        }

        function loadSubjectCompletionData() {
            // Load student information
            const studentInfo = {
                id: userData.studentId || '2023-001234',
                name: userData.name || 'JUAN DELA CRUZ',
                campus: 'Main Campus',
                college: 'College of Computer Studies',
                program: userData.program || 'BS Information Technology',
                yearLevel: userData.yearLevel || '3rd Year'
            };
            
            // Update student info header
            document.getElementById('completionStudentId').textContent = studentInfo.id;
            document.getElementById('completionStudentName').textContent = studentInfo.name;
            document.getElementById('completionCampus').textContent = studentInfo.campus;
            document.getElementById('completionCollege').textContent = studentInfo.college;
            document.getElementById('completionProgram').textContent = studentInfo.program;
            document.getElementById('completionYearLevel').textContent = studentInfo.yearLevel;
            
            // Load INC subjects
            const incSubjects = [
                {
                    id: 1,
                    code: 'IT 301',
                    name: 'Advanced Web Development',
                    units: 3,
                    academicSession: 'SY 2023-2024, 2nd Semester',
                    incStartDate: '2024-05-15',
                    incEndDate: '2024-11-15',
                    daysRemaining: 12,
                    status: 'Pending',
                    instructor: 'Prof. John Smith',
                    requirements: [
                        'Final Project Submission',
                        'Research Paper',
                        'Laboratory Exercises (3 sets)'
                    ]
                },
                {
                    id: 2,
                    code: 'CS 201',
                    name: 'Data Structures and Algorithms',
                    units: 3,
                    academicSession: 'SY 2023-2024, 1st Semester',
                    incStartDate: '2024-01-20',
                    incEndDate: '2024-07-20',
                    daysRemaining: -45,
                    status: 'Overdue',
                    instructor: 'Prof. Maria Garcia',
                    requirements: [
                        'Programming Assignments (5 sets)',
                        'Midterm Exam Make-up',
                        'Final Exam'
                    ]
                },
                {
                    id: 3,
                    code: 'IT 302',
                    name: 'Database Management Systems',
                    units: 3,
                    academicSession: 'SY 2022-2023, 2nd Semester',
                    incStartDate: '2023-06-10',
                    incEndDate: '2023-12-10',
                    daysRemaining: -300,
                    status: 'Completed',
                    instructor: 'Prof. Robert Johnson',
                    requirements: [
                        'Database Design Project',
                        'SQL Queries Final Exam',
                        'Case Study Analysis'
                    ]
                }
            ];
            
            // Update INC count
            document.getElementById('incCount').textContent = incSubjects.filter(s => s.status !== 'Completed').length;
            
            // Load INC subjects table
            const tableBody = document.getElementById('incSubjectsTableBody');
            tableBody.innerHTML = '';
            
            incSubjects.forEach((subject, index) => {
                const row = tableBody.insertRow();
                
                // Determine row class and status badge
                let rowClass = '';
                let statusBadge = '';
                let timeRemainingClass = '';
                
                if (subject.status === 'Completed') {
                    rowClass = 'completed-row';
                    statusBadge = '<span class="status-badge status-completion">Completed</span>';
                    timeRemainingClass = 'success';
                } else if (subject.status === 'Overdue') {
                    rowClass = 'overdue-row';
                    statusBadge = '<span class="status-badge status-overdue">Overdue</span>';
                    timeRemainingClass = 'danger';
                } else {
                    rowClass = 'inc-row';
                    statusBadge = '<span class="status-badge status-inc">Pending</span>';
                    timeRemainingClass = subject.daysRemaining < 30 ? 'danger' : 
                                        subject.daysRemaining < 60 ? 'warning' : 'success';
                }
                
                row.className = rowClass;
                
                // Format dates
                const formatDate = (dateStr) => {
                    const date = new Date(dateStr);
                    return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
                };
                
                // Format days remaining
                let daysRemainingText = '';
                if (subject.daysRemaining > 0) {
                    daysRemainingText = `${subject.daysRemaining} days`;
                } else if (subject.daysRemaining < 0) {
                    daysRemainingText = `${Math.abs(subject.daysRemaining)} days overdue`;
                } else {
                    daysRemainingText = 'Today is deadline';
                }
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td><strong>${subject.code}</strong></td>
                    <td>${subject.name}</td>
                    <td><span class="units-badge units-regular">${subject.units} units</span></td>
                    <td>${subject.academicSession}</td>
                    <td>${formatDate(subject.incStartDate)}</td>
                    <td>${formatDate(subject.incEndDate)}</td>
                    <td>
                        <div class="time-remaining ${timeRemainingClass}">
                            ${daysRemainingText}
                        </div>
                    </td>
                    <td>${statusBadge}</td>
                    <td>
                        <button class="btn btn-sm btn-outline" onclick="viewIncDetails(${subject.id})">
                            <i class="fas fa-eye"></i> View
                        </button>
                    </td>
                `;
            });
            
            // Load requirements grid
            const requirementsGrid = document.getElementById('completionRequirementsGrid');
            requirementsGrid.innerHTML = '';
            
            incSubjects.filter(s => s.status !== 'Completed').forEach(subject => {
                const requirementItem = document.createElement('div');
                requirementItem.className = 'requirement-item';
                
                requirementItem.innerHTML = `
                    <div class="requirement-title">
                        <i class="fas fa-book"></i> ${subject.code} - ${subject.name}
                    </div>
                    <ul class="requirement-list">
                        ${subject.requirements.map(req => `
                            <li>
                                <input type="checkbox" class="requirement-checkbox" id="req_${subject.id}_${subject.requirements.indexOf(req)}">
                                <label for="req_${subject.id}_${subject.requirements.indexOf(req)}">${req}</label>
                            </li>
                        `).join('')}
                    </ul>
                    <div style="margin-top: 15px; font-size: 0.85rem; color: #6b7280;">
                        <i class="fas fa-user-tie"></i> Instructor: ${subject.instructor}
                    </div>
                `;
                
                requirementsGrid.appendChild(requirementItem);
            });
            
            // Populate subject dropdown in form
            const subjectDropdown = document.getElementById('subjectToComplete');
            subjectDropdown.innerHTML = '<option value="">Select Subject</option>';
            
            incSubjects.filter(s => s.status !== 'Completed').forEach(subject => {
                const option = document.createElement('option');
                option.value = subject.id;
                option.textContent = `${subject.code} - ${subject.name} (${subject.academicSession})`;
                subjectDropdown.appendChild(option);
            });
            
            // Set default submission date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('submissionDate').value = today;
            
            // Set instructor name and email based on selected subject
            subjectDropdown.addEventListener('change', function() {
                const selectedId = parseInt(this.value);
                const selectedSubject = incSubjects.find(s => s.id === selectedId);
                
                if (selectedSubject) {
                    // Extract instructor name and create email
                    const instructorName = selectedSubject.instructor;
                    const instructorEmail = instructorName.toLowerCase()
                        .replace('prof. ', '')
                        .replace(' ', '.') + '@learngate.edu';
                    
                    document.getElementById('instructorName').value = instructorName;
                    document.getElementById('instructorEmail').value = instructorEmail;
                }
            });
        }

        function viewIncDetails(subjectId) {
            const subjects = [
                {
                    id: 1,
                    code: 'IT 301',
                    name: 'Advanced Web Development',
                    details: 'Web application development using modern frameworks. Incomplete due to pending final project submission.',
                    grade: 'INC',
                    reason: 'Medical leave during final project submission period'
                },
                {
                    id: 2,
                    code: 'CS 201',
                    name: 'Data Structures and Algorithms',
                    details: 'Fundamental data structures and algorithm analysis. Incomplete due to missed examinations.',
                    grade: 'INC',
                    reason: 'Family emergency during examination period'
                },
                {
                    id: 3,
                    code: 'IT 302',
                    name: 'Database Management Systems',
                    details: 'Database design, implementation, and management. Successfully completed.',
                    grade: '1.25',
                    reason: 'All requirements submitted on time'
                }
            ];
            
            const subject = subjects.find(s => s.id === subjectId);
            if (subject) {
                alert(`Subject Details:\n\n` +
                      `Code: ${subject.code}\n` +
                      `Name: ${subject.name}\n` +
                      `Details: ${subject.details}\n` +
                      `Current Grade: ${subject.grade}\n` +
                      `Reason: ${subject.reason}`);
            }
        }

        // Handle completion form submission
        document.getElementById('completionRequestForm')?.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = {
                subjectId: document.getElementById('subjectToComplete').value,
                subjectName: document.getElementById('subjectToComplete').selectedOptions[0]?.textContent,
                submissionDate: document.getElementById('submissionDate').value,
                submissionMethod: document.querySelector('input[name="submissionMethod"]:checked').value,
                instructorName: document.getElementById('instructorName').value,
                instructorEmail: document.getElementById('instructorEmail').value,
                remarks: document.getElementById('completionRemarks').value,
                submittedAt: new Date().toISOString()
            };
            
            // Save to localStorage
            const completionRequests = JSON.parse(localStorage.getItem('completionRequests') || '[]');
            completionRequests.push(formData);
            localStorage.setItem('completionRequests', JSON.stringify(completionRequests));
            
            showSuccess('Completion request submitted successfully! The instructor will review your submission.');
            
            // Reset form
            this.reset();
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('submissionDate').value = today;
            
            // Refresh data
            setTimeout(() => {
                loadSubjectCompletionData();
            }, 1000);
        });

        // ==================== STUDENT DATA FUNCTIONS ====================
        function loadStudentData() {
            const savedProfile = localStorage.getItem('studentProfile');
            if (savedProfile) {
                studentProfile = JSON.parse(savedProfile);
                
                if (studentProfile.dateOfAdmission) {
                    const admissionDate = new Date(studentProfile.dateOfAdmission);
                    studentEnrollmentYear = admissionDate.getFullYear();
                }
            } else {
                studentEnrollmentYear = 2021;
                studentProfile = {
                    lastName: 'Dela Cruz',
                    firstName: 'Juan',
                    middleName: 'Santos',
                    program: 'Bachelor of Science in Information Technology',
                    studentId: '2023-001234',
                    yearLevel: '3rd Year',
                    dateOfAdmission: '2021-08-15',
                    expectedGraduation: '2025-06-30'
                };
                localStorage.setItem('studentProfile', JSON.stringify(studentProfile));
            }
            
            generateAcademicYears();
        }

        function generateAcademicYears() {
            academicYears = [];
            const currentYear = new Date().getFullYear();
            
            for (let year = studentEnrollmentYear; year <= studentEnrollmentYear + studentCourseYears - 1; year++) {
                const sy = `${year}-${year + 1}`;
                const isFuture = year > currentYear;
                const yearLevel = year - studentEnrollmentYear + 1;
                
                academicYears.push({
                    id: sy,
                    name: `SY ${sy}`,
                    description: `School Year ${year}-${year + 1}`,
                    yearLevel: yearLevel,
                    isFuture: isFuture,
                    isCompleted: year < currentYear,
                    isCurrent: (year === currentYear) || (year === currentYear - 1 && currentYear >= 2024)
                });
            }
            
            const currentSY = `${currentYear}-${currentYear + 1}`;
            const foundCurrent = academicYears.find(y => y.isCurrent);
            currentAcademicYear = foundCurrent ? foundCurrent.id : academicYears[academicYears.length - 1]?.id || '';
        }

        // ==================== STUDENT PROFILE FUNCTIONS ====================
        function openStudentProfile() {
            console.log('Opening student profile modal');
            document.getElementById('studentProfileModal').style.display = 'block';
            loadProfileData();
            initializeProfileSections();
        }

        function closeStudentProfile() {
            document.getElementById('studentProfileModal').style.display = 'none';
        }

        function initializeProfileSections() {
            const profileNav = document.getElementById('profileNav');
            if (profileNav) {
                profileNav.scrollLeft = 0;
            }
            
            loadEnlistedSubjects();
            loadGradesData();
            loadClassSchedule();
            loadSubjectAttendance();
            loadSemesterPerformance();
            loadProfileDocuments();
            loadExamSchedule();
        }

        function showProfileSection(sectionId) {
            document.querySelectorAll('.profile-section').forEach(section => {
                section.classList.remove('active');
            });
            
            document.querySelectorAll('.profile-nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            const section = document.getElementById(sectionId + '-section');
            if (section) {
                section.classList.add('active');
            }
            
            const navItem = document.querySelector(`[data-section="${sectionId}"]`);
            if (navItem) {
                navItem.classList.add('active');
            }
            
            const profileNav = document.getElementById('profileNav');
            if (navItem && profileNav) {
                const navRect = profileNav.getBoundingClientRect();
                const itemRect = navItem.getBoundingClientRect();
                
                if (itemRect.left < navRect.left || itemRect.right > navRect.right) {
                    navItem.scrollIntoView({ behavior: 'smooth', inline: 'center' });
                }
            }
        }

        function loadProfileData() {
            const savedProfile = localStorage.getItem('studentProfile');
            if (savedProfile) {
                const profile = JSON.parse(savedProfile);
                
                // Personal Details
                document.getElementById('lastName').value = profile.lastName || '';
                document.getElementById('firstName').value = profile.firstName || '';
                document.getElementById('middleName').value = profile.middleName || '';
                document.getElementById('extensionName').value = profile.extensionName || '';
                document.getElementById('gender').value = profile.gender || '';
                document.getElementById('dob').value = profile.dob || '';
                document.getElementById('placeOfBirth').value = profile.placeOfBirth || '';
                document.getElementById('civilStatus').value = profile.civilStatus || '';
                document.getElementById('citizenship').value = profile.citizenship || '';
                if (profile.dualCitizenship) {
                    document.querySelector(`input[name="dualCitizenship"][value="${profile.dualCitizenship}"]`).checked = true;
                }
                document.getElementById('religion').value = profile.religion || '';
                document.getElementById('mobileNo').value = profile.mobileNo || '';
                document.getElementById('email').value = profile.email || '';
                document.getElementById('facebookName').value = profile.facebookName || '';
                document.getElementById('facebookLink').value = profile.facebookLink || '';
                
                // Family Details
                document.getElementById('fatherName').value = profile.fatherName || '';
                document.getElementById('fatherOccupation').value = profile.fatherOccupation || '';
                document.getElementById('fatherMobile').value = profile.fatherMobile || '';
                document.getElementById('motherName').value = profile.motherName || '';
                document.getElementById('motherOccupation').value = profile.motherOccupation || '';
                document.getElementById('motherMobile').value = profile.motherMobile || '';
                document.getElementById('spouseName').value = profile.spouseName || '';
                document.getElementById('spouseOccupation').value = profile.spouseOccupation || '';
                document.getElementById('childrenCount').value = profile.childrenCount || '';
                document.getElementById('guardianName').value = profile.guardianName || '';
                document.getElementById('guardianRelationship').value = profile.guardianRelationship || '';
                document.getElementById('guardianMobile').value = profile.guardianMobile || '';
                
                // Address Details
                document.getElementById('permanentAddress').value = profile.permanentAddress || '';
                document.getElementById('currentAddress').value = profile.currentAddress || '';
                document.getElementById('province').value = profile.province || '';
                document.getElementById('city').value = profile.city || '';
                document.getElementById('barangay').value = profile.barangay || '';
                document.getElementById('zipCode').value = profile.zipCode || '';
                document.getElementById('country').value = profile.country || 'Philippines';
                
                if (profile.sameAsPermanent) {
                    document.getElementById('sameAsPermanent').checked = true;
                    document.getElementById('currentAddress').readOnly = true;
                }
            }
        }

        function saveProfileData(section) {
            const profile = {
                lastName: document.getElementById('lastName').value,
                firstName: document.getElementById('firstName').value,
                middleName: document.getElementById('middleName').value,
                extensionName: document.getElementById('extensionName').value,
                gender: document.getElementById('gender').value,
                dob: document.getElementById('dob').value,
                placeOfBirth: document.getElementById('placeOfBirth').value,
                civilStatus: document.getElementById('civilStatus').value,
                citizenship: document.getElementById('citizenship').value,
                dualCitizenship: document.querySelector('input[name="dualCitizenship"]:checked')?.value,
                religion: document.getElementById('religion').value,
                mobileNo: document.getElementById('mobileNo').value,
                email: document.getElementById('email').value,
                facebookName: document.getElementById('facebookName').value,
                facebookLink: document.getElementById('facebookLink').value,
                
                fatherName: document.getElementById('fatherName').value,
                fatherOccupation: document.getElementById('fatherOccupation').value,
                fatherMobile: document.getElementById('fatherMobile').value,
                motherName: document.getElementById('motherName').value,
                motherOccupation: document.getElementById('motherOccupation').value,
                motherMobile: document.getElementById('motherMobile').value,
                spouseName: document.getElementById('spouseName').value,
                spouseOccupation: document.getElementById('spouseOccupation').value,
                childrenCount: document.getElementById('childrenCount').value,
                guardianName: document.getElementById('guardianName').value,
                guardianRelationship: document.getElementById('guardianRelationship').value,
                guardianMobile: document.getElementById('guardianMobile').value,
                
                permanentAddress: document.getElementById('permanentAddress').value,
                currentAddress: document.getElementById('currentAddress').value,
                sameAsPermanent: document.getElementById('sameAsPermanent').checked,
                province: document.getElementById('province').value,
                city: document.getElementById('city').value,
                barangay: document.getElementById('barangay').value,
                zipCode: document.getElementById('zipCode').value,
                country: document.getElementById('country').value,
                
                program: studentProfile.program || 'Bachelor of Science in Information Technology',
                studentId: studentProfile.studentId || '2023-001234',
                yearLevel: studentProfile.yearLevel || '3rd Year',
                dateOfAdmission: studentProfile.dateOfAdmission || '2021-08-15',
                expectedGraduation: studentProfile.expectedGraduation || '2025-06-30',
                
                lastUpdated: new Date().toISOString()
            };
            
            localStorage.setItem('studentProfile', JSON.stringify(profile));
            studentProfile = profile;
            
            if (profile.dateOfAdmission) {
                const admissionDate = new Date(profile.dateOfAdmission);
                studentEnrollmentYear = admissionDate.getFullYear();
                generateAcademicYears();
            }
            
            showSuccess(`${section} saved successfully!`);
            checkStudentProfileCompletion();
        }

        function saveCourseDetails() {
            alert('Course details saved!');
            showSuccess('Course details saved successfully!');
        }

        function previewPhoto(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById('photoPreview');
                    preview.innerHTML = `<img src="${e.target.result}" style="width:100%; height:100%; object-fit:cover;">`;
                };
                reader.readAsDataURL(file);
            }
        }

        function previewSignature(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById('signaturePreview');
                    preview.innerHTML = `<img src="${e.target.result}" style="width:100%; height:100%; object-fit:contain;">`;
                };
                reader.readAsDataURL(file);
            }
        }

        function createDigitalSignature() {
            alert('Opening digital signature creation tool...');
        }

        function savePhotoSignature() {
            alert('Photo and signature saved successfully!');
            showSuccess('Photo and signature saved successfully!');
        }

        function loadEnlistedSubjects() {
            const subjects = [
                { code: 'IT 301', name: 'Advanced Web Development', units: 3, schedule: 'MWF 9:00-10:30 AM', room: 'CS Lab 3', instructor: 'Prof. Smith', status: 'Enrolled' },
                { code: 'IT 302', name: 'Mobile Application Development', units: 3, schedule: 'TTh 10:30-12:00 PM', room: 'Room 205', instructor: 'Prof. Johnson', status: 'Enrolled' },
                { code: 'IT 303', name: 'Information Assurance', units: 3, schedule: 'MWF 1:00-2:30 PM', room: 'Net Lab 1', instructor: 'Prof. Davis', status: 'Enrolled' },
                { code: 'IT 304', name: 'Software Engineering', units: 3, schedule: 'TTh 2:00-3:30 PM', room: 'Room 301', instructor: 'Prof. Wilson', status: 'Enrolled' },
                { code: 'IT 305', name: 'Human Computer Interaction', units: 3, schedule: 'MWF 3:00-4:30 PM', room: 'Room 210', instructor: 'Prof. Brown', status: 'Enrolled' },
                { code: 'IT 306', name: 'IT Elective 1', units: 3, schedule: 'TTh 4:00-5:30 PM', room: 'Room 215', instructor: 'Prof. Taylor', status: 'Enrolled' }
            ];
            
            const table = document.getElementById('enlistedSubjectsTable');
            table.innerHTML = '';
            
            subjects.forEach(subject => {
                const row = table.insertRow();
                row.innerHTML = `
                    <td>${subject.code}</td>
                    <td>${subject.name}</td>
                    <td><span class="units-badge units-regular">${subject.units} units</span></td>
                    <td>${subject.schedule}</td>
                    <td>${subject.room}</td>
                    <td>${subject.instructor}</td>
                    <td><span class="status-badge status-active">${subject.status}</span></td>
                `;
            });
        }

        function printEnlistedSubjects() {
            alert('Printing enlisted subjects...');
        }

        function loadGradesData() {
            const yearSelector = document.getElementById('academicYearSelector');
            yearSelector.innerHTML = '';
            
            academicYears.forEach(year => {
                const button = document.createElement('button');
                let buttonClass = 'year-btn';
                
                if (year.id === currentAcademicYear) {
                    buttonClass += ' active current';
                } else if (year.isCompleted) {
                    buttonClass += ' completed';
                }
                
                button.className = buttonClass;
                button.textContent = year.name;
                button.setAttribute('data-year', year.id);
                button.setAttribute('title', `Year ${year.yearLevel}: ${year.description}`);
                button.onclick = () => selectAcademicYearForGrades(year.id);
                yearSelector.appendChild(button);
            });
            
            selectAcademicYearForGrades(currentAcademicYear);
        }

        function selectAcademicYearForGrades(yearId) {
            currentAcademicYear = yearId;
            
            document.querySelectorAll('#academicYearSelector .year-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-year') === yearId) {
                    btn.classList.add('active');
                }
            });
            
            loadSemesterGradesForProfile(currentSemester);
        }

        function showGradesSemester(semester) {
            currentSemester = semester;
            
            document.querySelectorAll('[data-semester]').forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-semester') === semester.toString()) {
                    btn.classList.add('active');
                }
            });
            
            loadSemesterGradesForProfile(semester);
        }

        function loadSemesterGradesForProfile(semester) {
            const year = academicYears.find(y => y.id === currentAcademicYear);
            const yearLevel = year?.yearLevel || 1;
            
            const grades = generateMockGrades(yearLevel, semester);
            
            const tableBody = document.getElementById('gradesTableBody');
            tableBody.innerHTML = '';
            
            grades.forEach(subject => {
                const gradeValue = parseFloat(subject.grade);
                let gradeClass = '';
                if (gradeValue <= 1.25) gradeClass = 'grade-excellent';
                else if (gradeValue <= 1.75) gradeClass = 'grade-good';
                else if (gradeValue <= 2.25) gradeClass = 'grade-fair';
                else gradeClass = 'grade-poor';
                
                const row = tableBody.insertRow();
                row.innerHTML = `
                    <td>${subject.code}</td>
                    <td>${subject.name}</td>
                    <td>${subject.units}</td>
                    <td class="${getGradeClass(subject.prelim)}">${subject.prelim}</td>
                    <td class="${getGradeClass(subject.midterm)}">${subject.midterm}</td>
                    <td class="${getGradeClass(subject.final)}">${subject.final}</td>
                    <td class="${gradeClass}">${subject.grade}</td>
                    <td><span class="status-badge status-completed">${subject.remarks}</span></td>
                `;
            });
        }

        function getGradeClass(grade) {
            const gradeValue = parseFloat(grade);
            if (gradeValue <= 1.25) return 'grade-excellent';
            if (gradeValue <= 1.75) return 'grade-good';
            if (gradeValue <= 2.25) return 'grade-fair';
            return 'grade-poor';
        }

        function generateMockGrades(yearLevel, semester) {
            let subjects = [];
            
            const subjectsByLevel = {
                1: {
                    1: [
                        { code: 'IT 101', name: 'Introduction to Computing', units: 3, prelim: '1.25', midterm: '1.00', final: '1.00', grade: '1.00', remarks: 'PASSED' },
                        { code: 'IT 102', name: 'Computer Programming 1', units: 3, prelim: '1.50', midterm: '1.25', final: '1.25', grade: '1.25', remarks: 'PASSED' },
                        { code: 'MATH 101', name: 'College Algebra', units: 3, prelim: '1.75', midterm: '1.50', final: '1.50', grade: '1.50', remarks: 'PASSED' },
                        { code: 'ENG 101', name: 'Communication Skills', units: 3, prelim: '2.00', midterm: '1.75', final: '1.75', grade: '1.75', remarks: 'PASSED' },
                        { code: 'FIL 101', name: 'Komunikasyon sa Akademikong Filipino', units: 3, prelim: '1.25', midterm: '1.25', final: '1.00', grade: '1.25', remarks: 'PASSED' },
                        { code: 'PE 101', name: 'Physical Fitness', units: 2, prelim: '1.00', midterm: '1.00', final: '1.00', grade: '1.00', remarks: 'PASSED' },
                        { code: 'NSTP 101', name: 'National Service Training Program', units: 3, prelim: '1.25', midterm: '1.25', final: '1.25', grade: '1.25', remarks: 'PASSED' }
                    ],
                    2: [
                        { code: 'IT 103', name: 'Computer Programming 2', units: 3, prelim: '1.50', midterm: '1.25', final: '1.25', grade: '1.25', remarks: 'PASSED' },
                        { code: 'IT 104', name: 'Discrete Mathematics', units: 3, prelim: '2.00', midterm: '1.75', final: '1.75', grade: '1.75', remarks: 'PASSED' },
                        { code: 'MATH 102', name: 'Trigonometry', units: 3, prelim: '1.75', midterm: '1.50', final: '1.50', grade: '1.50', remarks: 'PASSED' },
                        { code: 'ENG 102', name: 'Writing in the Discipline', units: 3, prelim: '1.50', midterm: '1.25', final: '1.25', grade: '1.25', remarks: 'PASSED' },
                        { code: 'SCI 101', name: 'Environmental Science', units: 3, prelim: '1.75', midterm: '1.50', final: '1.50', grade: '1.50', remarks: 'PASSED' },
                        { code: 'PE 102', name: 'Individual/Dual Sports', units: 2, prelim: '1.00', midterm: '1.00', final: '1.00', grade: '1.00', remarks: 'PASSED' },
                        { code: 'NSTP 102', name: 'NSTP Community Service', units: 3, prelim: '1.25', midterm: '1.25', final: '1.25', grade: '1.25', remarks: 'PASSED' }
                    ]
                },
                2: {
                    1: [
                        { code: 'IT 201', name: 'Data Structures', units: 3, prelim: '1.25', midterm: '1.00', final: '1.00', grade: '1.00', remarks: 'PASSED' },
                        { code: 'IT 202', name: 'Object-Oriented Programming', units: 3, prelim: '1.50', midterm: '1.25', final: '1.25', grade: '1.25', remarks: 'PASSED' },
                        { code: 'IT 203', name: 'Database Management Systems', units: 3, prelim: '1.75', midterm: '1.50', final: '1.50', grade: '1.50', remarks: 'PASSED' },
                        { code: 'MATH 201', name: 'Calculus 1', units: 3, prelim: '2.00', midterm: '1.75', final: '1.75', grade: '1.75', remarks: 'PASSED' },
                        { code: 'SCI 201', name: 'Physics for IT', units: 3, prelim: '1.50', midterm: '1.25', final: '1.25', grade: '1.25', remarks: 'PASSED' },
                        { code: 'HUM 101', name: 'Art Appreciation', units: 3, prelim: '1.00', midterm: '1.00', final: '1.00', grade: '1.00', remarks: 'PASSED' }
                    ],
                    2: [
                        { code: 'IT 204', name: 'Web Development', units: 3, prelim: '1.25', midterm: '1.00', final: '1.00', grade: '1.00', remarks: 'PASSED' },
                        { code: 'IT 205', name: 'Networking Fundamentals', units: 3, prelim: '1.50', midterm: '1.25', final: '1.25', grade: '1.25', remarks: 'PASSED' },
                        { code: 'IT 206', name: 'Systems Analysis and Design', units: 3, prelim: '1.75', midterm: '1.50', final: '1.50', grade: '1.50', remarks: 'PASSED' },
                        { code: 'MATH 202', name: 'Calculus 2', units: 3, prelim: '2.00', midterm: '1.75', final: '1.75', grade: '1.75', remarks: 'PASSED' },
                        { code: 'SCI 202', name: 'Chemistry for IT', units: 3, prelim: '1.50', midterm: '1.25', final: '1.25', grade: '1.25', remarks: 'PASSED' },
                        { code: 'SOC 101', name: 'Understanding the Self', units: 3, prelim: '1.00', midterm: '1.00', final: '1.00', grade: '1.00', remarks: 'PASSED' }
                    ]
                },
                3: {
                    1: [
                        { code: 'IT 301', name: 'Advanced Web Development', units: 3, prelim: '1.25', midterm: '1.00', final: '1.00', grade: '1.00', remarks: 'PASSED' },
                        { code: 'IT 302', name: 'Mobile Application Development', units: 3, prelim: '1.50', midterm: '1.25', final: '1.25', grade: '1.25', remarks: 'PASSED' },
                        { code: 'IT 303', name: 'Information Assurance', units: 3, prelim: '1.75', midterm: '1.50', final: '1.50', grade: '1.50', remarks: 'PASSED' },
                        { code: 'IT 304', name: 'Software Engineering', units: 3, prelim: '2.00', midterm: '1.75', final: '1.75', grade: '1.75', remarks: 'PASSED' },
                        { code: 'IT 305', name: 'Human Computer Interaction', units: 3, prelim: '1.50', midterm: '1.25', final: '1.25', grade: '1.25', remarks: 'PASSED' },
                        { code: 'IT 306', name: 'IT Elective 1', units: 3, prelim: '1.00', midterm: '1.00', final: '1.00', grade: '1.00', remarks: 'PASSED' }
                    ],
                    2: [
                        { code: 'IT 307', name: 'Capstone Project 1', units: 3, prelim: '1.25', midterm: '1.00', final: '1.00', grade: '1.00', remarks: 'PASSED' },
                        { code: 'IT 308', name: 'IT Project Management', units: 3, prelim: '1.50', midterm: '1.25', final: '1.25', grade: '1.25', remarks: 'PASSED' },
                        { code: 'IT 309', name: 'Cloud Computing', units: 3, prelim: '1.75', midterm: '1.50', final: '1.50', grade: '1.50', remarks: 'PASSED' },
                        { code: 'IT 310', name: 'Data Analytics', units: 3, prelim: '2.00', midterm: '1.75', final: '1.75', grade: '1.75', remarks: 'PASSED' },
                        { code: 'IT 311', name: 'IT Elective 2', units: 3, prelim: '1.50', midterm: '1.25', final: '1.25', grade: '1.25', remarks: 'PASSED' },
                        { code: 'IT 312', name: 'IT Elective 3', units: 3, prelim: '1.00', midterm: '1.00', final: '1.00', grade: '1.00', remarks: 'PASSED' }
                    ]
                },
                4: {
                    1: [
                        { code: 'IT 401', name: 'Capstone Project 2', units: 3, prelim: '1.25', midterm: '1.00', final: '1.00', grade: '1.00', remarks: 'PASSED' },
                        { code: 'IT 402', name: 'Internship', units: 6, prelim: '1.00', midterm: '1.00', final: '1.00', grade: '1.00', remarks: 'PASSED' },
                        { code: 'IT 403', name: 'Professional Issues', units: 3, prelim: '1.50', midterm: '1.25', final: '1.25', grade: '1.25', remarks: 'PASSED' },
                        { code: 'IT 404', name: 'IT Elective 4', units: 3, prelim: '1.75', midterm: '1.50', final: '1.50', grade: '1.50', remarks: 'PASSED' }
                    ],
                    2: [
                        { code: 'IT 405', name: 'Thesis', units: 6, prelim: '1.25', midterm: '1.00', final: '1.00', grade: '1.00', remarks: 'PASSED' },
                        { code: 'IT 406', name: 'IT Elective 5', units: 3, prelim: '1.50', midterm: '1.25', final: '1.25', grade: '1.25', remarks: 'PASSED' },
                        { code: 'IT 407', name: 'IT Elective 6', units: 3, prelim: '1.75', midterm: '1.50', final: '1.50', grade: '1.50', remarks: 'PASSED' }
                    ]
                }
            };
            
            if (subjectsByLevel[yearLevel] && subjectsByLevel[yearLevel][semester]) {
                subjects = subjectsByLevel[yearLevel][semester];
            } else if (semester === 'summer') {
                subjects = [
                    { code: 'IT 105', name: 'Data Structures', units: 3, prelim: '1.25', midterm: '1.00', final: '1.00', grade: '1.00', remarks: 'PASSED' },
                    { code: 'IT 106', name: 'Object-Oriented Programming', units: 3, prelim: '1.50', midterm: '1.25', final: '1.25', grade: '1.25', remarks: 'PASSED' }
                ];
            } else {
                subjects = [
                    { code: 'IT 000', name: 'Sample Subject', units: 3, prelim: '1.50', midterm: '1.25', final: '1.25', grade: '1.25', remarks: 'PASSED' }
                ];
            }
            
            return subjects;
        }

        function printGrades() {
            alert('Printing Grades...');
        }

        function downloadGradesPDF() {
            alert('Downloading Grades as PDF...');
        }

        function loadClassSchedule() {
            const schedule = [
                { time: '7:00-8:30', monday: '', tuesday: '', wednesday: '', thursday: 'IT 301', friday: '', saturday: '' },
                { time: '8:30-10:00', monday: 'IT 302', tuesday: '', wednesday: 'IT 302', thursday: '', friday: '', saturday: '' },
                { time: '10:00-11:30', monday: '', tuesday: 'IT 303', wednesday: '', thursday: 'IT 304', friday: '', saturday: '' },
                { time: '11:30-1:00', monday: '', tuesday: '', wednesday: '', thursday: '', friday: '', saturday: '' },
                { time: '1:00-2:30', monday: 'IT 305', tuesday: '', wednesday: 'IT 305', thursday: '', friday: '', saturday: '' },
                { time: '2:30-4:00', monday: '', tuesday: 'IT 306', wednesday: '', thursday: '', friday: 'Lab', saturday: '' },
                { time: '4:00-5:30', monday: '', tuesday: '', wednesday: '', thursday: '', friday: '', saturday: '' }
            ];
            
            const tableBody = document.getElementById('scheduleTableBody');
            tableBody.innerHTML = '';
            
            schedule.forEach(slot => {
                const row = tableBody.insertRow();
                row.innerHTML = `
                    <td class="time-slot">${slot.time}</td>
                    <td class="${slot.monday ? 'subject-cell' : ''}">${slot.monday}</td>
                    <td class="${slot.tuesday ? 'subject-cell' : ''}">${slot.tuesday}</td>
                    <td class="${slot.wednesday ? 'subject-cell' : ''}">${slot.wednesday}</td>
                    <td class="${slot.thursday ? 'subject-cell' : ''}">${slot.thursday}</td>
                    <td class="${slot.friday ? 'subject-cell' : ''}">${slot.friday}</td>
                    <td class="${slot.saturday ? 'subject-cell' : ''}">${slot.saturday}</td>
                `;
            });
        }

        function printSchedule() {
            alert('Printing Class Schedule...');
        }

        function downloadSchedulePDF() {
            alert('Downloading Class Schedule as PDF...');
        }

        function loadSubjectAttendance() {
            const attendanceData = [
                { subject: 'IT 301 - Web Development', total: 42, present: 38, absent: 3, late: 1, percentage: '90.5%', status: 'Good' },
                { subject: 'IT 302 - Database Systems', total: 40, present: 37, absent: 2, late: 1, percentage: '92.5%', status: 'Excellent' },
                { subject: 'IT 303 - Information Assurance', total: 38, present: 35, absent: 2, late: 1, percentage: '92.1%', status: 'Excellent' },
                { subject: 'IT 304 - Software Engineering', total: 36, present: 32, absent: 3, late: 1, percentage: '88.9%', status: 'Good' },
                { subject: 'IT 305 - HCI', total: 40, present: 36, absent: 3, late: 1, percentage: '90.0%', status: 'Good' },
                { subject: 'IT 306 - IT Elective 1', total: 38, present: 34, absent: 3, late: 1, percentage: '89.5%', status: 'Good' }
            ];
            
            const tableBody = document.getElementById('subjectAttendanceTable');
            tableBody.innerHTML = '';
            
            attendanceData.forEach(data => {
                const row = tableBody.insertRow();
                let statusClass = 'status-pending';
                if (data.status === 'Excellent') statusClass = 'status-active';
                else if (data.status === 'Good') statusClass = 'status-completed';
                
                row.innerHTML = `
                    <td>${data.subject}</td>
                    <td>${data.total}</td>
                    <td>${data.present}</td>
                    <td>${data.absent}</td>
                    <td>${data.late}</td>
                    <td>${data.percentage}</td>
                    <td><span class="status-badge ${statusClass}">${data.status}</span></td>
                `;
            });
        }

        function printAttendanceSummary() {
            alert('Printing Attendance Summary...');
        }

        function downloadAttendanceReport() {
            alert('Downloading Attendance Report...');
        }

        function loadSemesterPerformance() {
            const performanceData = [
                { year: 'SY 2021-2022', semester: '1st Semester', gpa: '3.75', units: 21, status: 'Passed' },
                { year: 'SY 2021-2022', semester: '2nd Semester', gpa: '3.80', units: 18, status: 'Passed' },
                { year: 'SY 2022-2023', semester: '1st Semester', gpa: '3.85', units: 21, status: 'Passed' },
                { year: 'SY 2022-2023', semester: '2nd Semester', gpa: '3.90', units: 18, status: 'Passed' },
                { year: 'SY 2023-2024', semester: '1st Semester', gpa: '3.95', units: 21, status: 'Passed' },
                { year: 'SY 2023-2024', semester: '2nd Semester', gpa: '3.85', units: 18, status: 'Passed' }
            ];
            
            const tableBody = document.getElementById('semesterPerformanceTable');
            tableBody.innerHTML = '';
            
            performanceData.forEach(data => {
                const row = tableBody.insertRow();
                row.innerHTML = `
                    <td>${data.year}</td>
                    <td>${data.semester}</td>
                    <td>${data.gpa}</td>
                    <td>${data.units}</td>
                    <td><span class="status-badge status-active">${data.status}</span></td>
                `;
            });
        }

        function downloadOverallReport() {
            alert('Downloading Overall Academic Report...');
        }

        function printExamPermit() {
            alert('Printing Exam Permit...');
        }

        function downloadExamPermit() {
            alert('Downloading Exam Permit as PDF...');
        }

        function loadProfileDocuments() {
            const documents = [
                { id: 1, name: 'Certificate of Enrollment', category: 'academic', size: '1.2 MB', date: '2024-10-15' },
                { id: 2, name: 'Official Transcript of Records', category: 'academic', size: '2.5 MB', date: '2024-09-30' },
                { id: 3, name: 'Registration Form', category: 'academic', size: '850 KB', date: '2024-08-25' },
                { id: 4, name: 'Class Schedule', category: 'academic', size: '450 KB', date: '2024-10-20' },
                { id: 5, name: 'Tuition Fee Assessment', category: 'financial', size: '1.8 MB', date: '2024-10-01' },
                { id: 6, name: 'Payment Receipts', category: 'financial', size: '3.2 MB', date: '2024-10-05' },
                { id: 7, name: 'Scholarship Certificate', category: 'financial', size: '1.5 MB', date: '2024-09-15' },
                { id: 8, name: 'Student ID Copy', category: 'legal', size: '750 KB', date: '2024-08-20' },
                { id: 9, name: 'Waiver Forms', category: 'legal', size: '950 KB', date: '2024-09-10' },
                { id: 10, name: 'Medical Certificate', category: 'others', size: '1.1 MB', date: '2024-10-10' },
                { id: 11, name: 'Clearance Form', category: 'others', size: '650 KB', date: '2024-10-12' },
                { id: 12, name: 'Library Clearance', category: 'others', size: '520 KB', date: '2024-10-18' }
            ];
            
            const grid = document.getElementById('profileDocumentsGrid');
            grid.innerHTML = '';
            
            documents.forEach(doc => {
                const card = document.createElement('div');
                card.className = 'document-card';
                
                let icon = '';
                switch(doc.category) {
                    case 'academic': icon = '<i class="fas fa-graduation-cap"></i>'; break;
                    case 'financial': icon = '<i class="fas fa-file-invoice-dollar"></i>'; break;
                    case 'legal': icon = '<i class="fas fa-file-contract"></i>'; break;
                    default: icon = '<i class="fas fa-file-alt"></i>';
                }
                
                card.innerHTML = `
                    <div class="document-icon">${icon}</div>
                    <div class="document-name">${doc.name}</div>
                    <div class="document-size">Size: ${doc.size}</div>
                    <div class="document-size">Date: ${formatDate(doc.date)}</div>
                    <div class="document-actions">
                        <button class="btn btn-sm btn-outline" onclick="previewProfileDocument(${doc.id})">
                            <i class="fas fa-eye"></i> Preview
                        </button>
                        <button class="btn btn-sm btn-primary" onclick="downloadProfileDocument(${doc.id})">
                            <i class="fas fa-download"></i> Download
                        </button>
                    </div>
                `;
                
                grid.appendChild(card);
            });
        }

        function previewProfileDocument(id) {
            alert(`Previewing document #${id}...`);
        }

        function downloadProfileDocument(id) {
            alert(`Downloading document #${id}...`);
            showSuccess('Document download started');
        }

        function refreshProfileDocuments() {
            showBanner('info', 'Refreshing documents...');
            setTimeout(() => {
                loadProfileDocuments();
                showSuccess('Documents refreshed');
            }, 1000);
        }

        function loadExamSchedule() {
            const exams = [
                { subject: 'IT 301 - Advanced Web Development', date: 'November 15, 2024', time: '9:00 AM - 12:00 PM', room: 'Room 301', type: 'Midterm' },
                { subject: 'IT 302 - Mobile Application Development', date: 'November 18, 2024', time: '1:00 PM - 4:00 PM', room: 'Computer Lab 2', type: 'Midterm' },
                { subject: 'IT 303 - Information Assurance', date: 'November 20, 2024', time: '9:00 AM - 12:00 PM', room: 'Room 205', type: 'Midterm' },
                { subject: 'IT 304 - Software Engineering', date: 'November 22, 2024', time: '1:00 PM - 4:00 PM', room: 'Room 210', type: 'Midterm' },
                { subject: 'IT 305 - Human Computer Interaction', date: 'November 25, 2024', time: '9:00 AM - 12:00 PM', room: 'Room 301', type: 'Midterm' },
                { subject: 'IT 306 - IT Elective 1', date: 'November 27, 2024', time: '1:00 PM - 4:00 PM', room: 'Room 215', type: 'Midterm' }
            ];
            
            const container = document.getElementById('examScheduleList');
            container.innerHTML = '';
            
            exams.forEach(exam => {
                const card = document.createElement('div');
                card.className = 'exam-schedule-card';
                card.innerHTML = `
                    <div class="exam-subject">${exam.subject} (${exam.type})</div>
                    <div class="exam-details">
                        <div><i class="far fa-calendar"></i> ${exam.date}</div>
                        <div><i class="far fa-clock"></i> ${exam.time}</div>
                        <div><i class="fas fa-door-open"></i> ${exam.room}</div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function printExamSchedule() {
            alert('Printing Exam Schedule...');
        }

        function downloadExamSchedule() {
            alert('Downloading Exam Schedule...');
        }

        document.getElementById('defermentForm')?.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const defermentData = {
                semester: document.getElementById('defermentSemester').value,
                period: document.getElementById('defermentPeriod').value,
                reason: document.querySelector('input[name="defermentReason"]:checked').value,
                explanation: document.getElementById('defermentExplanation').value,
                expectedReturn: document.getElementById('expectedReturnDate').value,
                submittedDate: new Date().toISOString()
            };
            
            localStorage.setItem('defermentRequest', JSON.stringify(defermentData));
            
            alert('Deferment request submitted successfully!\n\nYour request will be reviewed within 7-14 working days.');
            showSuccess('Deferment request submitted successfully!');
        });

        // ==================== ATTENDANCE FUNCTIONS ====================
        function openAttendanceTracker() {
            console.log('Opening Attendance Tracker modal');
            document.getElementById('attendanceModal').style.display = 'block';
            loadAttendanceData();
        }

        function closeAttendanceModal() {
            document.getElementById('attendanceModal').style.display = 'none';
        }

        function loadAttendanceData() {
            const subject = document.getElementById('attendanceSubject').value;
            const tableBody = document.getElementById('attendanceTableBody');
            
            const attendanceRecords = [
                { date: '2024-08-26', day: 'Monday', time: '9:00-10:30', status: 'Present', remarks: '' },
                { date: '2024-08-28', day: 'Wednesday', time: '9:00-10:30', status: 'Present', remarks: '' },
                { date: '2024-08-30', day: 'Friday', time: '9:00-10:30', status: 'Present', remarks: '' },
                { date: '2024-09-02', day: 'Monday', time: '9:00-10:30', status: 'Present', remarks: '' },
                { date: '2024-09-04', day: 'Wednesday', time: '9:00-10:30', status: 'Late', remarks: 'Arrived 15 minutes late' },
                { date: '2024-09-06', day: 'Friday', time: '9:00-10:30', status: 'Present', remarks: '' },
                { date: '2024-09-09', day: 'Monday', time: '9:00-10:30', status: 'Absent', remarks: 'Medical leave' },
                { date: '2024-09-11', day: 'Wednesday', time: '9:00-10:30', status: 'Present', remarks: '' },
                { date: '2024-09-13', day: 'Friday', time: '9:00-10:30', status: 'Present', remarks: '' },
                { date: '2024-09-16', day: 'Monday', time: '9:00-10:30', status: 'Present', remarks: '' }
            ];
            
            tableBody.innerHTML = '';
            
            attendanceRecords.forEach(record => {
                const row = tableBody.insertRow();
                
                let statusBadge = '';
                if (record.status === 'Present') {
                    statusBadge = '<span class="status-badge status-present">Present</span>';
                } else if (record.status === 'Absent') {
                    statusBadge = '<span class="status-badge status-absent">Absent</span>';
                } else if (record.status === 'Late') {
                    statusBadge = '<span class="status-badge status-late">Late</span>';
                }
                
                row.innerHTML = `
                    <td><span class="date-badge">${formatDate(record.date)}</span></td>
                    <td>${record.day}</td>
                    <td>${record.time}</td>
                    <td>${statusBadge}</td>
                    <td>${record.remarks}</td>
                `;
            });
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        }

        function printAttendance() {
            alert('Printing Attendance Report...');
        }

        function requestAttendanceCorrection() {
            alert('Opening Attendance Correction Form...');
        }

        // ==================== DOCUMENTS FUNCTIONS ====================
        function openDownloadDocuments() {
            console.log('Opening Download Documents modal');
            document.getElementById('documentsModal').style.display = 'block';
            loadDocuments();
        }

        function closeDocumentsModal() {
            document.getElementById('documentsModal').style.display = 'none';
        }

        function loadDocuments() {
            const documents = [
                { id: 1, name: 'Certificate of Enrollment', category: 'academic', size: '1.2 MB', date: '2024-10-15' },
                { id: 2, name: 'Official Transcript of Records', category: 'academic', size: '2.5 MB', date: '2024-09-30' },
                { id: 3, name: 'Registration Form', category: 'academic', size: '850 KB', date: '2024-08-25' },
                { id: 4, name: 'Class Schedule', category: 'academic', size: '450 KB', date: '2024-10-20' },
                { id: 5, name: 'Tuition Fee Assessment', category: 'financial', size: '1.8 MB', date: '2024-10-01' },
                { id: 6, name: 'Payment Receipts', category: 'financial', size: '3.2 MB', date: '2024-10-05' },
                { id: 7, name: 'Scholarship Certificate', category: 'financial', size: '1.5 MB', date: '2024-09-15' },
                { id: 8, name: 'Student ID Copy', category: 'legal', size: '750 KB', date: '2024-08-20' },
                { id: 9, name: 'Waiver Forms', category: 'legal', size: '950 KB', date: '2024-09-10' },
                { id: 10, name: 'Medical Certificate', category: 'others', size: '1.1 MB', date: '2024-10-10' },
                { id: 11, name: 'Clearance Form', category: 'others', size: '650 KB', date: '2024-10-12' },
                { id: 12, name: 'Library Clearance', category: 'others', size: '520 KB', date: '2024-10-18' }
            ];
            
            const grid = document.getElementById('documentsGrid');
            grid.innerHTML = '';
            
            documents.forEach(doc => {
                const card = document.createElement('div');
                card.className = 'document-card';
                card.setAttribute('data-category', doc.category);
                
                let icon = '';
                switch(doc.category) {
                    case 'academic': icon = '<i class="fas fa-graduation-cap"></i>'; break;
                    case 'financial': icon = '<i class="fas fa-file-invoice-dollar"></i>'; break;
                    case 'legal': icon = '<i class="fas fa-file-contract"></i>'; break;
                    default: icon = '<i class="fas fa-file-alt"></i>';
                }
                
                card.innerHTML = `
                    <div class="document-icon">${icon}</div>
                    <div class="document-name">${doc.name}</div>
                    <div class="document-size">Size: ${doc.size}</div>
                    <div class="document-size">Date: ${formatDate(doc.date)}</div>
                    <div class="document-actions">
                        <button class="btn btn-sm btn-outline" onclick="previewDocument(${doc.id})">
                            <i class="fas fa-eye"></i> Preview
                        </button>
                        <button class="btn btn-sm btn-primary" onclick="downloadDocument(${doc.id})">
                            <i class="fas fa-download"></i> Download
                        </button>
                    </div>
                `;
                
                grid.appendChild(card);
            });
        }

        function filterDocuments(category) {
            document.querySelectorAll('#documentsGrid .document-card').forEach(card => {
                if (category === 'all' || card.getAttribute('data-category') === category) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
            
            document.querySelectorAll('#documentsModal .year-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        function previewDocument(id) {
            alert(`Previewing document #${id}...`);
        }

        function downloadDocument(id) {
            alert(`Downloading document #${id}...`);
            showSuccess('Document download started');
        }

        function refreshDocuments() {
            showBanner('info', 'Refreshing documents...');
            setTimeout(() => {
                loadDocuments();
                showSuccess('Documents refreshed');
            }, 1000);
        }

        // ==================== CAMPUS RESOURCES FUNCTIONS ====================
        function openCampusResources() {
            console.log('Opening Campus Resources modal');
            document.getElementById('resourcesModal').style.display = 'block';
        }

        function closeResourcesModal() {
            document.getElementById('resourcesModal').style.display = 'none';
        }

        // ==================== STUDENT CLUBS FUNCTIONS ====================
        function openStudentClubs() {
            console.log('Opening Student Clubs modal');
            document.getElementById('clubsModal').style.display = 'block';
            loadClubs();
        }

        function closeClubsModal() {
            document.getElementById('clubsModal').style.display = 'none';
        }

        function loadClubs() {
            const clubs = [
                { 
                    id: 1, 
                    name: 'Programming Guild', 
                    category: 'Technology',
                    description: 'For students interested in software development, competitive programming, and tech innovations.',
                    members: 45,
                    president: 'John Smith'
                },
                { 
                    id: 2, 
                    name: 'Literary Society', 
                    category: 'Arts & Culture',
                    description: 'Promotes creative writing, poetry, literature appreciation, and publishing.',
                    members: 32,
                    president: 'Maria Garcia'
                },
                { 
                    id: 3, 
                    name: 'Green Warriors', 
                    category: 'Environment',
                    description: 'Environmental advocacy group focused on sustainability and campus greening projects.',
                    members: 28,
                    president: 'David Chen'
                },
                { 
                    id: 4, 
                    name: 'Business Leaders Club', 
                    category: 'Business',
                    description: 'Develops entrepreneurship skills through workshops, networking, and startup projects.',
                    members: 52,
                    president: 'Sarah Johnson'
                },
                { 
                    id: 5, 
                    name: 'Volunteer Corps', 
                    category: 'Community Service',
                    description: 'Organizes community outreach programs and volunteer activities.',
                    members: 67,
                    president: 'Michael Brown'
                },
                { 
                    id: 6, 
                    name: 'Sports Enthusiasts', 
                    category: 'Sports',
                    description: 'Promotes sportsmanship and organizes intramural sports competitions.',
                    members: 89,
                    president: 'James Wilson'
                }
            ];
            
            const grid = document.getElementById('clubsGrid');
            grid.innerHTML = '';
            
            clubs.forEach(club => {
                const card = document.createElement('div');
                card.className = 'club-card';
                
                let icon = '';
                switch(club.category) {
                    case 'Technology': icon = '<i class="fas fa-laptop-code"></i>'; break;
                    case 'Arts & Culture': icon = '<i class="fas fa-palette"></i>'; break;
                    case 'Environment': icon = '<i class="fas fa-leaf"></i>'; break;
                    case 'Business': icon = '<i class="fas fa-chart-line"></i>'; break;
                    case 'Community Service': icon = '<i class="fas fa-hands-helping"></i>'; break;
                    case 'Sports': icon = '<i class="fas fa-running"></i>'; break;
                }
                
                card.innerHTML = `
                    <div class="club-header">
                        <div class="club-name">${club.name}</div>
                        <div class="club-category">${icon} ${club.category}</div>
                    </div>
                    <div class="club-body">
                        <div class="club-description">${club.description}</div>
                        <div class="club-meta">
                            <div class="club-members">
                                <i class="fas fa-users"></i> ${club.members} members
                            </div>
                            <div>President: ${club.president}</div>
                        </div>
                        <div class="club-actions">
                            <button class="btn btn-sm btn-outline" onclick="viewClubDetails(${club.id})">
                                <i class="fas fa-info-circle"></i> Details
                            </button>
                            <button class="btn btn-sm btn-primary" onclick="joinClub(${club.id})">
                                <i class="fas fa-sign-in-alt"></i> Join Club
                            </button>
                        </div>
                    </div>
                `;
                
                grid.appendChild(card);
            });
        }

        function viewClubDetails(id) {
            alert(`Viewing details for club #${id}...`);
        }

        function joinClub(id) {
            alert(`Request sent to join club #${id}...`);
            showSuccess('Join request submitted successfully!');
        }

        function browseAllClubs() {
            alert('Browsing all clubs...');
        }

        function createNewClub() {
            alert('Opening new club registration form...');
        }

        // ==================== HEALTH SERVICES FUNCTIONS ====================
        function openHealthServices() {
            console.log('Opening Health Services modal');
            document.getElementById('healthModal').style.display = 'block';
            loadHealthServices();
        }

        function closeHealthModal() {
            document.getElementById('healthModal').style.display = 'none';
        }

        function loadHealthServices() {
            const services = [
                { 
                    id: 1, 
                    name: 'Medical Clinic', 
                    description: 'Free medical consultations, first aid, and basic medications.',
                    hours: 'Monday-Friday: 8:00 AM - 5:00 PM',
                    icon: '<i class="fas fa-clinic-medical"></i>'
                },
                { 
                    id: 2, 
                    name: 'Dental Clinic', 
                    description: 'Basic dental checkups, cleaning, and oral health education.',
                    hours: 'Tuesday & Thursday: 9:00 AM - 4:00 PM',
                    icon: '<i class="fas fa-tooth"></i>'
                },
                { 
                    id: 3, 
                    name: 'Counseling Services', 
                    description: 'Confidential counseling for stress, anxiety, and personal issues.',
                    hours: 'By appointment only',
                    icon: '<i class="fas fa-head-side-virus"></i>'
                },
                { 
                    id: 4, 
                    name: 'Health Education', 
                    description: 'Workshops on nutrition, mental health, and healthy lifestyle.',
                    hours: 'Monthly seminars',
                    icon: '<i class="fas fa-heartbeat"></i>'
                },
                { 
                    id: 5, 
                    name: 'Immunization Program', 
                    description: 'Free vaccinations for common illnesses.',
                    hours: 'Quarterly schedule',
                    icon: '<i class="fas fa-syringe"></i>'
                },
                { 
                    id: 6, 
                    name: 'Emergency Response', 
                    description: '24/7 emergency medical response team on campus.',
                    hours: '24/7 Emergency Hotline',
                    icon: '<i class="fas fa-ambulance"></i>'
                }
            ];
            
            const grid = document.getElementById('healthServicesGrid');
            grid.innerHTML = '';
            
            services.forEach(service => {
                const card = document.createElement('div');
                card.className = 'service-card';
                
                card.innerHTML = `
                    <div class="service-icon">${service.icon}</div>
                    <div class="service-name">${service.name}</div>
                    <div class="service-desc">${service.description}</div>
                    <div class="service-hours">
                        <i class="far fa-clock"></i> ${service.hours}
                    </div>
                    <div style="margin-top: 15px;">
                        <button class="btn btn-sm btn-outline" onclick="viewServiceDetails(${service.id})">
                            <i class="fas fa-info-circle"></i> Details
                        </button>
                        <button class="btn btn-sm btn-primary" onclick="bookService(${service.id})">
                            <i class="fas fa-calendar-check"></i> Book Now
                        </button>
                    </div>
                `;
                
                grid.appendChild(card);
            });
        }

        function viewServiceDetails(id) {
            alert(`Viewing details for health service #${id}...`);
        }

        function bookService(id) {
            alert(`Booking health service #${id}...`);
        }

        function scheduleAppointment() {
            alert('Opening appointment scheduler...');
        }

        function reportEmergency() {
            alert('Opening emergency reporting form...');
        }

        // ==================== COURSE ENLISTMENT FUNCTIONS ====================
        function openCourseEnlistment() {
            console.log('Opening course enlistment modal');
            document.getElementById('courseEnlistmentModal').style.display = 'block';
            resetEnlistmentProcess();
            loadAvailableSubjects();
        }

        function closeCourseEnlistment() {
            document.getElementById('courseEnlistmentModal').style.display = 'none';
            resetEnlistmentProcess();
        }

        function resetEnlistmentProcess() {
            updateEnlistmentStepper();
            showEnlistmentStep(1);
        }

        function updateEnlistmentStepper() {
            document.querySelectorAll('#courseEnlistmentModal .step').forEach(step => {
                step.classList.remove('active', 'completed');
            });
            
            document.getElementById(`enlistmentStep1`).classList.add('active');
        }

        function showEnlistmentStep(stepNumber) {
            document.querySelectorAll('#courseEnlistmentModal .step-content').forEach(content => {
                content.classList.remove('active');
            });
            
            document.getElementById(`enlistmentStep${stepNumber}-content`).classList.add('active');
        }

        function previousEnlistmentStep() {
            const currentStep = document.querySelector('#courseEnlistmentModal .step-content.active').id.replace('enlistmentStep', '').replace('-content', '');
            const prevStep = parseInt(currentStep) - 1;
            if (prevStep >= 1) {
                updateEnlistmentStepper();
                for (let i = 1; i < prevStep; i++) {
                    document.getElementById(`enlistmentStep${i}`).classList.add('completed');
                }
                document.getElementById(`enlistmentStep${prevStep}`).classList.add('active');
                showEnlistmentStep(prevStep);
            }
        }

        function nextToEnlistmentStep3() {
            updateEnlistmentStepper();
            document.getElementById('enlistmentStep1').classList.add('completed');
            document.getElementById('enlistmentStep2').classList.add('completed');
            document.getElementById('enlistmentStep3').classList.add('active');
            showEnlistmentStep(3);
        }

        function loadAvailableSubjects() {
            const subjects = [
                { code: 'IT 301', name: 'Advanced Web Development', units: 3, schedule: 'MWF 9:00-10:30 AM', room: 'CS Lab 3', instructor: 'Prof. Smith', status: 'Available' },
                { code: 'IT 302', name: 'Mobile Application Development', units: 3, schedule: 'TTh 10:30-12:00 PM', room: 'Room 205', instructor: 'Prof. Johnson', status: 'Available' },
                { code: 'IT 303', name: 'Information Assurance', units: 3, schedule: 'MWF 1:00-2:30 PM', room: 'Net Lab 1', instructor: 'Prof. Davis', status: 'Prerequisite Required' },
                { code: 'IT 304', name: 'Software Engineering', units: 3, schedule: 'TTh 2:00-3:30 PM', room: 'Room 301', instructor: 'Prof. Wilson', status: 'Available' },
                { code: 'IT 305', name: 'Human Computer Interaction', units: 3, schedule: 'MWF 3:00-4:30 PM', room: 'Room 210', instructor: 'Prof. Brown', status: 'Available' },
                { code: 'IT 306', name: 'IT Elective 1', units: 3, schedule: 'TTh 4:00-5:30 PM', room: 'Room 215', instructor: 'Prof. Taylor', status: 'Available' }
            ];
            
            const table = document.getElementById('subjectSelectionTable');
            table.innerHTML = '';
            
            subjects.forEach(subject => {
                const row = table.insertRow();
                const isAvailable = subject.status === 'Available';
                const rowClass = isAvailable ? '' : 'style="background-color: #fee2e2;"';
                
                row.innerHTML = `
                    <td>
                        <input type="checkbox" ${isAvailable ? '' : 'disabled'} onchange="updateSelectedUnits(this, ${subject.units})">
                    </td>
                    <td>${subject.code}</td>
                    <td>${subject.name}</td>
                    <td><span class="units-badge units-regular">${subject.units} units</span></td>
                    <td>${subject.schedule}</td>
                    <td>${subject.room}</td>
                    <td>${subject.instructor}</td>
                    <td>
                        ${isAvailable ? 
                            '<span class="status-badge status-active">Available</span>' : 
                            '<span class="status-badge status-pending">Prerequisite Required</span>'
                        }
                    </td>
                `;
            });
            
            updateTotalUnits();
        }

        function updateSelectedUnits(checkbox, units) {
            const totalUnitsElement = document.getElementById('totalUnitsSelected');
            const statusText = document.getElementById('enlistmentStatusText');
            const proceedButton = document.getElementById('proceedToEnlistmentStep3');
            
            let currentUnits = parseInt(totalUnitsElement.textContent) || 0;
            
            if (checkbox.checked) {
                currentUnits += units;
            } else {
                currentUnits -= units;
            }
            
            totalUnitsElement.textContent = `${currentUnits} units`;
            
            if (currentUnits >= 12 && currentUnits <= 21) {
                statusText.textContent = 'Ready for Submission';
                statusText.style.color = '#10b981';
                proceedButton.disabled = false;
            } else if (currentUnits > 21) {
                statusText.textContent = 'Exceeds Maximum Units';
                statusText.style.color = '#ef4444';
                proceedButton.disabled = true;
            } else {
                statusText.textContent = 'Select at least 12 units';
                statusText.style.color = '#ef4444';
                proceedButton.disabled = true;
            }
        }

        function updateTotalUnits() {
            const checkboxes = document.querySelectorAll('#subjectSelectionTable input[type="checkbox"]:checked');
            let totalUnits = 0;
            
            checkboxes.forEach(checkbox => {
                const row = checkbox.closest('tr');
                const unitsCell = row.querySelector('.units-badge');
                const units = parseInt(unitsCell.textContent);
                totalUnits += units;
            });
            
            document.getElementById('totalUnitsSelected').textContent = `${totalUnits} units`;
        }

        function submitEnlistment() {
            document.getElementById('pendingEnlistmentStatus').style.display = 'block';
            document.getElementById('approvedEnlistmentStatus').style.display = 'none';
            document.getElementById('rejectedEnlistmentStatus').style.display = 'none';
            
            showSuccess('Enlistment submitted successfully!');
        }

        function downloadORF() {
            alert('Downloading Official Registration Form...');
        }

        function downloadOfficialForm() {
            alert('Downloading Official Registration Form (Approved)...');
        }

        function resubmitEnlistment() {
            updateEnlistmentStepper();
            document.getElementById('enlistmentStep1').classList.add('completed');
            document.getElementById('enlistmentStep2').classList.add('active');
            showEnlistmentStep(2);
        }

        function contactAdvisor() {
            alert('Contacting Academic Advisor...');
        }

        // ==================== MY PAYMENT FUNCTIONS ====================
        function openMyPayment() {
            console.log('Opening My Payment modal');
            document.getElementById('myPaymentModal').style.display = 'block';
            resetPaymentProcess();
            checkStudentProfileCompletion();
            checkOutstandingBalance();
        }

        function closeMyPayment() {
            document.getElementById('myPaymentModal').style.display = 'none';
            resetPaymentProcess();
        }

        function openDownPayment() {
            openMyPayment();
        }

        function resetPaymentProcess() {
            updatePaymentStepper();
            showPaymentStep(1);
        }

        function updatePaymentStepper() {
            document.querySelectorAll('#myPaymentModal .step').forEach(step => {
                step.classList.remove('active', 'completed');
            });
            
            document.getElementById(`paymentStep1`).classList.add('active');
        }

        function showPaymentStep(stepNumber) {
            document.querySelectorAll('#myPaymentModal .step-content').forEach(content => {
                content.classList.remove('active');
            });
            
            document.getElementById(`paymentStep${stepNumber}-content`).classList.add('active');
        }

        function previousPaymentStep() {
            const currentStep = document.querySelector('#myPaymentModal .step-content.active').id.replace('paymentStep', '').replace('-content', '');
            const prevStep = parseInt(currentStep) - 1;
            if (prevStep >= 1) {
                updatePaymentStepper();
                for (let i = 1; i < prevStep; i++) {
                    document.getElementById(`paymentStep${i}`).classList.add('completed');
                }
                document.getElementById(`paymentStep${prevStep}`).classList.add('active');
                showPaymentStep(prevStep);
            }
        }

        function checkStudentProfileCompletion() {
            const savedProfile = localStorage.getItem('studentProfile');
            if (!savedProfile) {
                document.getElementById('profileAlert').innerHTML = `
                    <div class="alert-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="alert-content">
                        <div class="alert-title">Student Profile Incomplete</div>
                        <div>Kindly complete your student profile one time to proceed for down payment. 
                        <a href="#" onclick="openStudentProfile(); closeMyPayment(); return false;" style="color: #3b82f6; text-decoration: underline; margin-left: 5px;">Complete Profile Now</a></div>
                    </div>
                `;
            } else {
                document.getElementById('profileAlert').style.display = 'none';
            }
        }

        function checkOutstandingBalance() {
            const hasOutstandingBalance = Math.random() > 0.7;
            
            if (hasOutstandingBalance) {
                document.getElementById('balanceAlert').style.display = 'flex';
            } else {
                document.getElementById('balanceAlert').style.display = 'none';
            }
        }

        function selectPaymentMethod(method) {
            const methodNames = {
                'online': 'Online Payment',
                'cash': 'Cash Payment',
                'installment': 'Installment Plan',
                'bank': 'Bank Deposit'
            };
            
            document.getElementById('selectedPaymentMethod').textContent = methodNames[method];
            
            document.getElementById('cashPaymentInstructions').style.display = method === 'cash' ? 'flex' : 'none';
            document.getElementById('bankDetails').style.display = method === 'bank' ? 'flex' : 'none';
            document.getElementById('installmentOptions').style.display = method === 'installment' ? 'flex' : 'none';
        }

        function submitPaymentRequest() {
            updatePaymentStepper();
            document.getElementById('paymentStep1').classList.add('completed');
            document.getElementById('paymentStep2').classList.add('completed');
            document.getElementById('paymentStep3').classList.add('active');
            showPaymentStep(3);
            
            showSuccess('Payment request submitted successfully!');
        }

        function applyPromissoryNote() {
            alert('Promissory Note Application\n\nRedirecting to promissory note application form...');
        }

        function clearOutstandingBalance() {
            alert('Clear Outstanding Balance\n\nRedirecting to payment gateway...');
        }

        function downloadPaymentReceipt() {
            alert('Downloading Payment Request Receipt...');
        }

        function downloadOfficialReceipt() {
            alert('Downloading Official Receipt...');
        }

        function downloadRegistrationForm() {
            alert('Downloading Registration Form...');
        }

        function viewPaymentHistory() {
            alert('Viewing Payment History...');
        }

        function resubmitPayment() {
            updatePaymentStepper();
            document.getElementById('paymentStep1').classList.add('completed');
            document.getElementById('paymentStep2').classList.add('active');
            showPaymentStep(2);
        }

        function contactFinanceOffice() {
            alert('Contacting Finance Office...\n\nPhone: (02) 1234-5678\nEmail: finance@learngate.edu');
        }

        function checkPaymentStatus() {
            showSuccess('Payment status checked. Still pending approval.');
        }

        // ==================== CALENDAR FUNCTIONS ====================
        function initializeCalendar() {
            renderCalendar();
            
            setInterval(() => {
                updateTodayIndicator();
                updateCalendarEvents();
            }, 60000);
        }

        function renderCalendar() {
            const container = document.getElementById('calendarContainer');
            if (!container) return;
            
            const month = currentDate.getMonth();
            const year = currentDate.getFullYear();
            
            const monthNames = ["January", "February", "March", "April", "May", "June",
                "July", "August", "September", "October", "November", "December"];
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const today = new Date();
            
            let html = `
                <div class="calendar-header">
                    <button class="calendar-nav-btn" onclick="previousMonth()">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <div class="calendar-month-year">${monthNames[month]} ${year}</div>
                    <button class="calendar-nav-btn" onclick="nextMonth()">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
                <div class="calendar-weekdays">
                    <div class="weekday">Sun</div>
                    <div class="weekday">Mon</div>
                    <div class="weekday">Tue</div>
                    <div class="weekday">Wed</div>
                    <div class="weekday">Thu</div>
                    <div class="weekday">Fri</div>
                    <div class="weekday">Sat</div>
                </div>
                <div class="calendar-days">
            `;
            
            const firstDayIndex = firstDay.getDay();
            for (let i = 0; i < firstDayIndex; i++) {
                const prevDate = new Date(year, month, -i);
                html += `<div class="calendar-day other-month"></div>`;
            }
            
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const dateKey = formatDateKey(date);
                const isToday = date.toDateString() === today.toDateString();
                const isSelected = selectedDate.toDateString() === date.toDateString();
                const hasEvent = hasEventOnDate(date);
                
                let dayClass = 'calendar-day current-month';
                if (isToday) dayClass += ' today';
                if (isSelected) dayClass += ' selected';
                if (hasEvent) dayClass += ' has-event';
                
                html += `
                    <div class="${dayClass}" onclick="selectDate('${dateKey}')">
                        ${day}
                    </div>
                `;
            }
            
            const lastDayIndex = lastDay.getDay();
            const remainingDays = 6 - lastDayIndex;
            for (let i = 1; i <= remainingDays; i++) {
                html += `<div class="calendar-day other-month"></div>`;
            }
            
            html += `</div>`;
            
            const selectedDateKey = formatDateKey(selectedDate);
            const events = getEventsForDate(selectedDateKey);
            
            html += `
                <div class="calendar-events">
                    <div class="calendar-events-title">Events for ${selectedDate.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' })}</div>
            `;
            
            if (events.length > 0) {
                events.forEach(event => {
                    html += `
                        <div class="calendar-event-item">
                            <div class="calendar-event-time">${event.time}</div>
                            <div class="calendar-event-title">${event.title}</div>
                            <div class="calendar-event-class">${event.location || ''}</div>
                        </div>
                    `;
                });
            } else {
                html += `<div class="calendar-empty">No events scheduled for this date</div>`;
            }
            
            html += `</div>`;
            
            container.innerHTML = html;
        }

        function formatDateKey(date) {
            return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
        }

        function hasEventOnDate(date) {
            const dateKey = formatDateKey(date);
            const events = getEventsForDate(dateKey);
            return events.length > 0;
        }

        function getEventsForDate(dateKey) {
            const date = new Date(dateKey);
            const dayOfWeek = date.getDay();
            const events = [];
            
            if (dayOfWeek >= 1 && dayOfWeek <= 5) {
                events.push({
                    time: '9:00 AM - 10:30 AM',
                    title: 'Web Development Class',
                    location: 'Room 301, CS Building'
                });
                
                if (dayOfWeek <= 4) {
                    events.push({
                        time: '1:00 PM - 2:30 PM',
                        title: 'Database Systems Lab',
                        location: 'Computer Lab 2'
                    });
                }
            }
            
            const month = date.getMonth() + 1;
            const day = date.getDate();
            
            if (month === 10 && day === 31) {
                events.push({
                    time: '6:00 PM - 9:00 PM',
                    title: 'Halloween Party',
                    location: 'Student Center'
                });
            }
            
            if (month === 12 && day === 15) {
                events.push({
                    time: 'All Day',
                    title: 'Final Exams Begin',
                    location: 'Various Classrooms'
                });
            }
            
            return events;
        }

        function updateTodayIndicator() {
            const today = new Date();
            const todayKey = formatDateKey(today);
            
            document.querySelectorAll('.calendar-day').forEach(day => {
                day.classList.remove('today');
            });
            
            const todayCell = document.querySelector(`[onclick*="${todayKey}"]`);
            if (todayCell) {
                todayCell.classList.add('today');
            }
        }

        function updateCalendarEvents() {
            const selectedDateKey = formatDateKey(selectedDate);
            const events = getEventsForDate(selectedDateKey);
            const eventsContainer = document.querySelector('.calendar-events');
            
            if (eventsContainer) {
                eventsContainer.querySelector('.calendar-events-title').textContent = 
                    `Events for ${selectedDate.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' })}`;
                
                const eventsList = eventsContainer.querySelector('.calendar-event-item')?.parentNode || eventsContainer;
                eventsList.innerHTML = '';
                
                if (events.length > 0) {
                    events.forEach(event => {
                        const eventItem = document.createElement('div');
                        eventItem.className = 'calendar-event-item';
                        eventItem.innerHTML = `
                            <div class="calendar-event-time">${event.time}</div>
                            <div class="calendar-event-title">${event.title}</div>
                            <div class="calendar-event-class">${event.location || ''}</div>
                        `;
                        eventsList.appendChild(eventItem);
                    });
                } else {
                    eventsList.innerHTML = `<div class="calendar-empty">No events scheduled for this date</div>`;
                }
            }
        }

        function previousMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar();
        }

        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar();
        }

        function selectDate(dateKey) {
            selectedDate = new Date(dateKey);
            renderCalendar();
        }

        function refreshCalendar() {
            renderCalendar();
            showSuccess('Calendar refreshed!');
        }

        // ==================== ORIGINAL DASHBOARD FUNCTIONS ====================
        const elements = {
            errorMessage: document.getElementById('errorMessage'),
            successMessage: document.getElementById('successMessage'),
            loadingSpinner: document.getElementById('loadingSpinner'),
            loadingText: document.getElementById('loadingText'),
            welcomeBanner: document.getElementById('welcomeBanner'),
            courseStatus: document.getElementById('courseStatus'),
            userName: document.getElementById('userName'),
            userAvatar: document.getElementById('userAvatar'),
            statusText: document.getElementById('statusText'),
            welcomeName: document.getElementById('welcomeName'),
            welcomeMessage: document.getElementById('welcomeMessage'),
            studentId: document.getElementById('studentId'),
            studentProgram: document.getElementById('studentProgram'),
            studentYear: document.getElementById('studentYear'),
            studentGPA: document.getElementById('studentGPA'),
            currentCourse: document.getElementById('currentCourse'),
            connectionBanner: document.getElementById('connectionBanner'),
            bannerText: document.getElementById('bannerText'),
            currentSubjects: document.getElementById('currentSubjects'),
            notificationsList: document.getElementById('notificationsList'),
            lastUpdateTime: document.getElementById('lastUpdateTime'),
            docCount: document.getElementById('docCount'),
            studentServicesToggle: document.getElementById('studentServicesToggle'),
            studentServicesContent: document.getElementById('studentServicesContent'),
            academicActivitiesToggle: document.getElementById('academicActivitiesToggle'),
            academicActivitiesContent: document.getElementById('academicActivitiesContent'),
            programCard: document.getElementById('programCard'),
            calendarContainer: document.getElementById('calendarContainer')
        };

        function checkAuthState() {
            showLoading('Checking authentication...');
            
            if (!auth) {
                checkLocalAuth();
                return;
            }
            
            auth.onAuthStateChanged(async (user) => {
                if (user) {
                    currentUser = user;
                    await initializeUserData();
                } else {
                    checkLocalAuth();
                }
            });
        }

        function checkLocalAuth() {
            const storedUser = localStorage.getItem('currentUser');
            if (storedUser) {
                userData = JSON.parse(storedUser);
                currentUser = { uid: 'local-user', email: userData.email || 'local@user.com' };
                updateUIWithUserData();
                showDashboard();
                loadMockNotifications();
                loadMockSubjects();
                showBanner('info', 'Using local data. Sign in for real-time updates.');
            } else {
                redirectToLogin();
            }
        }

        async function initializeUserData() {
            showLoading('Loading your data...');
            
            if (!db) {
                loadFromLocalStorage();
                return;
            }
            
            try {
                const userDoc = await db.collection('users').doc(currentUser.uid).get();
                
                if (userDoc.exists) {
                    userData = userDoc.data();
                    localStorage.setItem('currentUser', JSON.stringify(userData));
                    updateUIWithUserData();
                    showDashboard();
                    showSuccess('Dashboard loaded successfully!');
                } else {
                    await createNewUserDocument();
                }
                
            } catch (error) {
                console.error('Error loading user data:', error);
                loadFromLocalStorage();
            }
        }

        function loadFromLocalStorage() {
            const storedUser = localStorage.getItem('currentUser');
            if (storedUser) {
                userData = JSON.parse(storedUser);
                updateUIWithUserData();
                showDashboard();
                loadMockNotifications();
                loadMockSubjects();
                showBanner('info', 'Using local data. Sign in for real-time updates.');
            } else {
                showError('No user data found. Please sign in.');
                setTimeout(() => {
                    window.location.href = 'login.html';
                }, 2000);
            }
        }

        function updateUIWithUserData() {
            const name = userData.name || 'Student';
            const program = userData.program || 'Not Assigned';
            const studentId = userData.studentId || 'N/A';
            const yearLevel = userData.yearLevel || 'N/A';
            const gpa = userData.gpa || 'N/A';
            const status = userData.status || 'Active';
            
            elements.userName.textContent = name;
            elements.statusText.textContent = status;
            elements.userAvatar.textContent = name.charAt(0).toUpperCase();
            
            elements.welcomeName.textContent = name;
            elements.welcomeMessage.textContent = `Welcome to your student dashboard. You are currently enrolled in ${program}.`;
            
            elements.studentProgram.textContent = program;
            elements.studentId.textContent = studentId;
            elements.studentYear.textContent = yearLevel;
            elements.studentGPA.textContent = gpa;
            
            const programLower = program.toLowerCase();
            if (programLower.includes('bsit')) {
                elements.programCard.classList.add('bsit');
            } else if (programLower.includes('bscs')) {
                elements.programCard.classList.add('bscs');
            }
            
            elements.currentCourse.textContent = program;
            elements.courseStatus.textContent = `Status: ${status}`;
        }

        function loadMockNotifications() {
            const notifications = [
                {
                    time: '2 hours ago',
                    title: 'Enlistment Period Open',
                    message: 'Course enlistment for 2nd Semester AY 2024-2025 is now open.'
                },
                {
                    time: '1 day ago',
                    title: 'Payment Deadline Reminder',
                    message: 'Reminder: Down payment deadline is on November 15, 2024.'
                },
                {
                    time: '2 days ago',
                    title: 'New Grade Posted',
                    message: 'Your grade for IT 301 - Web Development has been posted.'
                }
            ];
            
            const container = elements.notificationsList;
            container.innerHTML = '';
            
            notifications.forEach(notification => {
                const item = document.createElement('div');
                item.className = 'notification-item';
                item.innerHTML = `
                    <div class="notification-time">
                        <i class="far fa-clock"></i> ${notification.time}
                    </div>
                    <div class="notification-title">${notification.title}</div>
                    <div class="notification-message">${notification.message}</div>
                `;
                container.appendChild(item);
            });
        }

        function loadMockSubjects() {
            const subjects = [
                { code: 'IT 301', name: 'Web Development', instructor: 'Prof. Smith', schedule: 'MWF 9:00-10:30 AM' },
                { code: 'IT 302', name: 'Database Systems', instructor: 'Prof. Johnson', schedule: 'TTh 10:30-12:00 PM' },
                { code: 'CS 201', name: 'Data Structures', instructor: 'Prof. Wilson', schedule: 'TTh 2:00-3:30 PM' }
            ];
            
            const container = elements.currentSubjects;
            container.innerHTML = '';
            
            subjects.forEach(subject => {
                const card = document.createElement('div');
                card.className = 'subject-card';
                card.innerHTML = `
                    <div>
                        <div style="font-weight: 500; color: var(--primary);">${subject.code}</div>
                        <div style="font-size: 0.9rem; color: var(--dark);">${subject.name}</div>
                        <div style="font-size: 0.8rem; color: var(--gray);">${subject.instructor}</div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-size: 0.9rem; font-weight: 500; color: var(--dark);">${subject.schedule}</div>
                        <div class="status-badge status-active" style="margin-top: 5px;">Enrolled</div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function updateDateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            const dateString = now.toLocaleDateString([], { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            
            elements.lastUpdateTime.textContent = `${timeString}`;
            elements.docCount.textContent = `Last updated: ${dateString}`;
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                showLoading('Logging out...');
                
                try {
                    unsubscribeFunctions.forEach(unsubscribe => unsubscribe());
                    if (calendarEventListener) {
                        calendarEventListener();
                    }
                    
                    if (auth) {
                        auth.signOut();
                    }
                    
                    localStorage.removeItem('currentUser');
                    
                    setTimeout(() => {
                        window.location.href = 'login.html';
                    }, 1000);
                    
                } catch (error) {
                    console.error('Logout error:', error);
                    showError('Logout failed: ' + error.message);
                }
            }
        }

        function showLoading(text) {
            elements.loadingText.textContent = text;
            elements.loadingSpinner.style.display = 'flex';
        }

        function hideLoading() {
            elements.loadingSpinner.style.display = 'none';
        }

        function showError(message) {
            elements.errorMessage.innerHTML = `
                <i class="fas fa-exclamation-triangle"></i> ${message}
                <button onclick="this.parentElement.style.display='none'" 
                        style="background:none; border:none; color:white; margin-left:15px; cursor:pointer;">
                    <i class="fas fa-times"></i>
                </button>
            `;
            elements.errorMessage.style.display = 'block';
            
            setTimeout(() => {
                elements.errorMessage.style.display = 'none';
            }, 5000);
        }

        function showSuccess(message) {
            elements.successMessage.innerHTML = `
                <i class="fas fa-check-circle"></i> ${message}
                <button onclick="this.parentElement.style.display='none'" 
                        style="background:none; border:none; color:white; margin-left:15px; cursor:pointer;">
                    <i class="fas fa-times"></i>
                </button>
            `;
            elements.successMessage.style.display = 'block';
            setTimeout(() => {
                elements.successMessage.style.display = 'none';
            }, 5000);
        }

        function showBanner(type, message) {
            elements.connectionBanner.className = `connection-banner ${type}`;
            elements.bannerText.innerHTML = `<i class="fas fa-${type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i> ${message}`;
            elements.connectionBanner.style.display = 'block';
            
            if (type === 'success') {
                setTimeout(() => {
                    elements.connectionBanner.style.display = 'none';
                }, 5000);
            }
        }

        function showDashboard() {
            elements.loadingSpinner.style.display = 'none';
            elements.welcomeBanner.style.display = 'block';
            showBanner('success', 'Dashboard loaded successfully! All features are now active.');
        }

        function viewSchedule() {
            alert('CLASS SCHEDULE\n\nView your schedule...');
        }

        function openAddDropSubject() {
            alert('ADD/DROP SUBJECT\n\nAdd or drop subjects...');
        }

        function openStudentRequest() {
            alert('STUDENT REQUEST\n\nSubmit requests...');
        }

        function openAssignmentPortal() {
            alert('ASSIGNMENT PORTAL\n\nView and submit assignments...');
        }

        function openExaminationSchedule() {
            alert('EXAMINATION SCHEDULE\n\nView exam schedules...');
        }

        function openLibraryAccess() {
            alert('LIBRARY ACCESS\n\nAccess library resources...');
        }

        function openResearchPortal() {
            alert('RESEARCH PORTAL\n\nResearch resources...');
        }

        function loadNotifications() {
            showBanner('info', 'Refreshing notifications...');
            setTimeout(() => {
                showSuccess('Notifications refreshed');
            }, 1000);
        }

        function toggleSection(sectionId) {
            const content = document.getElementById(`${sectionId}Content`);
            const toggle = document.getElementById(`${sectionId}Toggle`);
            
            if (content && toggle) {
                content.classList.toggle('collapsed');
                toggle.classList.toggle('collapsed');
                
                if (!content.classList.contains('collapsed')) {
                    setTimeout(() => {
                        content.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                    }, 100);
                }
            }
        }

        function initializeCollapsibleSections() {
            const sections = ['studentServices', 'academicActivities'];
            sections.forEach(section => {
                const content = document.getElementById(`${section}Content`);
                const toggle = document.getElementById(`${section}Toggle`);
                if (content && toggle) {
                    content.classList.remove('collapsed');
                    toggle.classList.remove('collapsed');
                }
            });
        }

        // ==================== FORM SUBMISSION HANDLERS ====================
        document.getElementById('personalDetailsForm')?.addEventListener('submit', function(e) {
            e.preventDefault();
            saveProfileData('Personal Details');
        });

        document.getElementById('familyDetailsForm')?.addEventListener('submit', function(e) {
            e.preventDefault();
            saveProfileData('Family Details');
        });

        document.getElementById('addressDetailsForm')?.addEventListener('submit', function(e) {
            e.preventDefault();
            saveProfileData('Address Details');
        });

        document.getElementById('enlistmentDetailsForm')?.addEventListener('submit', function(e) {
            e.preventDefault();
            updateEnlistmentStepper();
            document.getElementById('enlistmentStep1').classList.add('completed');
            document.getElementById('enlistmentStep2').classList.add('active');
            showEnlistmentStep(2);
        });

        document.getElementById('paymentDetailsForm')?.addEventListener('submit', function(e) {
            e.preventDefault();
            updatePaymentStepper();
            document.getElementById('paymentStep1').classList.add('completed');
            document.getElementById('paymentStep2').classList.add('active');
            showPaymentStep(2);
        });

        document.getElementById('sameAsPermanent')?.addEventListener('change', function(e) {
            if (e.target.checked) {
                const permanentAddress = document.getElementById('permanentAddress').value;
                document.getElementById('currentAddress').value = permanentAddress;
                document.getElementById('currentAddress').readOnly = true;
            } else {
                document.getElementById('currentAddress').readOnly = false;
            }
        });

        function redirectToLogin() {
            console.log('Redirecting to login...');
            window.location.href = 'login.html';
        }

        console.log(' Dashboard with UPDATED Subject Completion loaded successfully');
    </script>
</body>
</html>